<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NOPE</title>
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#000000">
    <style>
        /* ===== RESET & BASE ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            background: #000;
            color: #fff;
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            min-height: 100vh;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
        }
        /* ===== PAGES ===== */
        .page {
            display: none;
            width: 100%;
            max-width: 500px;
            margin: 0 auto;
            padding: 15px;
            min-height: 100vh;
            padding-bottom: 70px; /* Untuk bottom nav */
        }
        .page.active {
            display: block;
        }
        /* ===== LOGO NOPE ===== */
       .logo {
    font-size: 25px;
    font-weight: 900;
    color: #ff9999;
    margin: 200px 0 0px 20px; /* sesuaikan */
    line-height: 1;
    letter-spacing: -3px;
    display: block;
}
        /* ===== INPUT STYLE ===== */
        .nope-input {
            width: 100%;
            background: transparent;
            border: none;
            border-bottom: 1px solid rgba(73, 3, 252, 0.2);
            color: white;
            font-size: 22px;
            text-align: center;
            padding: 10px 0;
            outline: none;
            font-weight: 300;
            margin: 25px 0 15px 0;
        }
        .nope-input:focus {
            border-bottom-color: #4903fc;
        }
        /* ===== HINT TEXT ===== */
        .hint {
            text-align: center;
            color: rgba(73, 3, 252, 0.4);
            font-size: 12px;
            margin: 6px 0;
            line-height: 1.4;
        }
        .hint strong {
            color: rgba(73, 3, 252, 0.7);
        }
        /* ===== USER STATUS ===== */
        .user-status {
            text-align: center;
            margin: 10px 0;
            padding: 10px;
            font-size: 13px;
            line-height: 1.4;
            background: rgba(73, 3, 252, 0.05);
            color: rgba(73, 3, 252, 0.7);
            display: none;
            border-radius: 6px;
        }
        .user-status.show {
            display: block;
        }
        /* ===== ZONA SELECTION HEADER ===== */
        .zona-header {
            text-align: center;
            margin: 15px 0 25px 0;
        }
        .zona-title {
            font-size: 16px;
            font-weight: 600;
            color: #4903fc;
            margin-bottom: 5px;
        }
        .zona-subtitle {
            font-size: 12px;
            color: rgba(73, 3, 252, 0.5);
        }
        /* ===== ZONA CARD ===== */
        .zona-card {
            background: rgba(73, 3, 252, 0.03);
            border: 1px solid rgba(73, 3, 252, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
        }
        .zona-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(73, 3, 252, 0.1);
        }
        .zona-card-name {
            font-size: 16px;
            font-weight: 600;
            color: #4903fc;
        }
        .zona-card-desc {
            font-size: 11px;
            color: rgba(73, 3, 252, 0.5);
        }
        .zona-card-counter {
            font-size: 13px;
            color: #4903fc;
            font-weight: 600;
        }
        /* ===== HASHTAG SELECTION ===== */
        .hashtag-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .hashtag-item {
            padding: 10px;
            background: rgba(73, 3, 252, 0.05);
            border: 1px solid rgba(73, 3, 252, 0.08);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .hashtag-item:hover {
            background: rgba(73, 3, 252, 0.08);
        }
        .hashtag-item.selected {
            background: rgba(73, 3, 252, 0.15);
            border-color: #4903fc;
            box-shadow: 0 2px 6px rgba(73, 3, 252, 0.1);
        }
        .hashtag-name {
            font-size: 14px;
            font-weight: 500;
            color: rgba(73, 3, 252, 0.9);
            margin-bottom: 3px;
        }
        .hashtag-microcopy {
            font-size: 10px;
            color: rgba(73, 3, 252, 0.5);
            line-height: 1.3;
            font-style: italic;
        }
        /* ===== ACTION BUTTONS ===== */
        .action-btn {
            width: 100%;
            padding: 12px;
            margin: 8px 0;
            background: rgba(73, 3, 252, 0.15);
            border: 1px solid #4903fc;
            color: white;
            font-family: inherit;
            font-size: 16px;
            font-weight: 600;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
        }
        .action-btn:hover:not(:disabled) {
            background: rgba(73, 3, 252, 0.25);
            transform: translateY(-2px);
            box-shadow: 0 3px 8px rgba(73, 3, 252, 0.2);
        }
        .action-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }
        .action-btn.secondary {
            background: rgba(73, 3, 252, 0.05);
            border-color: rgba(73, 3, 252, 0.1);
        }
        .action-btn.secondary:hover {
            background: rgba(73, 3, 252, 0.1);
        }
        /* ===== JEJAK PAGE - REVISI ===== */
        /* Artefak Preview - FULL SCREEN */
        .artefak-preview-container {
            margin: 15px 0;
            position: relative;
            width: 100%;
        }
        .artefak-preview {
            width: 100%;
            position: relative;
            background: rgba(73, 3, 252, 0.03);
            border: 1px solid rgba(73, 3, 252, 0.1);
            border-radius: 10px;
            overflow: hidden;
            transition: all 0.3s;
        }
        .artefak-preview-image {
            width: 100%;
            height: 300px; /* TINGGI FIXED UNTUK FULL SCREEN */
            background: linear-gradient(135deg, rgba(73, 3, 252, 0.1), rgba(73, 3, 252, 0.1));
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }
        .artefak-preview-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            object-position: center;
        }
        /* Notasi "Nobar terakhir sama mantan" di kiri atas */
        .artefak-nobar-badge {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid rgba(255, 100, 100, 0.5);
            color: #ff9999;
            font-size: 10px;
            padding: 4px 8px;
            border-radius: 6px;
            z-index: 10;
            font-weight: 600;
            letter-spacing: 0.5px;
        }
        .artefak-placeholder {
            font-size: 48px;
            color: rgba(73, 3, 252, 0.2);
        }
        .artefak-preview-info {
            padding: 10px;
        }
        .artefak-preview-title {
            font-size: 14px;
            font-weight: 600;
            color: #fff;
            margin-bottom: 3px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .artefak-preview-date {
            font-size: 10px;
            color: rgba(73, 3, 252, 0.4);
        }
        /* CTA Unggah Proses di kiri bawah */
        .upload-process-cta {
            position: absolute;
            bottom: 10px;
            left: 10px;
            background: rgba(73, 3, 252, 0.9);
            border: none;
            color: white;
            font-size: 11px;
            padding: 6px 10px;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 4px;
            z-index: 10;
            transition: all 0.2s;
            font-weight: 600;
            letter-spacing: 0.5px;
        }
        .upload-process-cta:hover {
            background: rgba(73, 3, 252, 1);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(73, 3, 252, 0.3);
        }
        /* Rant Box */
        .rant-box-container {
            margin: 20px 0;
        }
        .rant-box-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        .rant-box-title {
            font-size: 14px;
            font-weight: 600;
            color: #4903fc;
        }
        .rant-box-counter {
            font-size: 11px;
            color: rgba(73, 3, 252, 0.5);
            display: block;
        }
        .rant-box {
            width: 100%;
            min-height: 100px;
            background: rgba(73, 3, 252, 0.03);
            border: 1px solid rgba(73, 3, 252, 0.1);
            border-radius: 8px;
            padding: 12px;
            color: white;
            font-family: inherit;
            font-size: 13px;
            line-height: 1.4;
            resize: none;
            margin-bottom: 8px;
        }
        .rant-box:focus {
            outline: none;
            border-color: #4903fc;
            background: rgba(73, 3, 252, 0.05);
        }
        .rant-box::placeholder {
            color: rgba(73, 3, 252, 0.3);
        }
        .rant-box-footer {
            display: flex;
            justify-content: flex-end;
            align-items: center;
            margin-top: 10px;
        }
        .rant-box-footer .gaskeun-btn {
            background: transparent;
            border: none;
            color: #4903fc;
            font-family: inherit;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            padding: 8px 16px;
            border-radius: 6px;
            transition: all 0.2s;
            text-decoration: none;
        }
        .rant-box-footer .gaskeun-btn:hover {
            background: rgba(73, 3, 252, 0.1);
        }
        /* Recent Rants Section */
        .recent-rants {
            margin: 20px 0;
        }
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .section-title {
            font-size: 14px;
            font-weight: 600;
            color: #4903fc;
        }
        .section-view-all {
            font-size: 11px;
            color: rgba(73, 3, 252, 0.5);
            cursor: pointer;
            transition: color 0.2s;
        }
        .section-view-all:hover {
            color: #4903fc;
        }
        .recent-rants-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .recent-rant-item {
            background: rgba(73, 3, 252, 0.03);
            border: 1px solid rgba(73, 3, 252, 0.08);
            border-radius: 6px;
            padding: 10px;
            transition: all 0.2s;
            cursor: pointer;
        }
        .recent-rant-item:hover {
            background: rgba(73, 3, 252, 0.05);
            transform: translateY(-2px);
        }
        .recent-rant-date {
            font-size: 10px;
            color: rgba(73, 3, 252, 0.4);
            margin-bottom: 3px;
        }
        .recent-rant-content {
            font-size: 12px;
            color: rgba(73, 3, 252, 0.8);
            line-height: 1.4;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        /* ===== JALAN PAGE ===== */
        .jalan-header {
            text-align: center;
            margin: 15px 0 15px 0;
        }
        .jalan-title {
            font-size: 18px;
            font-weight: 600;
            color: #4903fc;
            margin-bottom: 8px;
        }
        .jalan-tab-nav {
            display: flex;
            justify-content: space-around;
            margin: 10px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            padding-bottom: 6px;
        }
        .jalan-tab-btn {
            background: none;
            border: none;
            color: rgba(255,255,255,0.6);
            font-size: 12px;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
        }
        .jalan-tab-btn.active {
            color: #4903fc;
            background: rgba(73, 3, 252, 0.1);
        }
        .jalan-tab-content {
            margin-top: 10px;
        }
        /* ARTEFAK DI FEED - VISUAL PENUH */
        .artefak-feed-item {
            background: rgba(73, 3, 252, 0.03);
            border: 1px solid rgba(73, 3, 252, 0.08);
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 10px;
            transition: all 0.3s;
            cursor: pointer;
        }
        .artefak-feed-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(73, 3, 252, 0.15);
        }
        .artefak-feed-image {
            width: 100%;
            height: 200px; /* TINGGI FIXED UNTUK VISUAL PENUH */
            overflow: hidden;
            position: relative;
        }
        .artefak-feed-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            object-position: center;
        }
        .artefak-feed-info {
            padding: 10px;
        }
        .artefak-feed-username {
            font-size: 10px;
            color: rgba(73, 3, 252, 0.7);
            margin-bottom: 4px;
        }
        .artefak-feed-title {
            font-size: 13px;
            font-weight: 600;
            color: white;
            margin-bottom: 6px;
            line-height: 1.3;
        }
        .artefak-feed-date {
            font-size: 9px;
            color: rgba(255, 255, 255, 0.4);
        }
        /* COMPACT RANT LIST */
        .recent-rants-list.compact {
            gap: 10px !important;
            margin-top: 10px;
        }
        .recent-rant-item.compact {
            padding: 10px !important;
            border-radius: 8px !important;
        }
        .recent-rant-date.compact {
            font-size: 9px;
            color: rgba(255, 255, 255, 0.4);
            margin-bottom: 3px;
        }
        .recent-rant-content.compact {
            font-size: 12px;
            line-height: 1.4;
            margin-bottom: 5px;
        }
        .rant-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 10px;
            color: rgba(255, 255, 255, 0.6);
        }
        .rant-emoji-bar {
            display: flex;
            gap: 5px;
        }
        .emoji-btn {
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.7);
            font-size: 13px;
            cursor: pointer;
            padding: 2px;
            border-radius: 4px;
        }
        .emoji-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        .emoji-btn.active {
            color: #4903fc;
        }
        /* ===== DUNIA PAGE ===== */
        .dunia-header {
            text-align: center;
            margin: 15px 0 25px 0;
        }
        .dunia-title {
            font-size: 18px;
            font-weight: 600;
            color: #4903fc;
            margin-bottom: 8px;
        }
        .dunia-subtitle {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.6);
        }
        .profile-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }
        .profile-username {
            font-size: 20px;
            font-weight: 700;
            color: #4903fc;
            margin-bottom: 8px;
        }
        .profile-meta {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.5);
            margin: 5px 0;
        }
        /* ===== POST MODAL ===== */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 15px;
        }
        .modal-overlay.active {
            display: flex;
        }
        .modal {
            background: rgba(0, 0, 0, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            width: 100%;
            max-width: 450px;
            max-height: 90vh;
            overflow-y: auto;
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        .modal-title {
            font-size: 18px;
            font-weight: 600;
            color: #4903fc;
        }
        .modal-close {
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.5);
            font-size: 22px;
            cursor: pointer;
            padding: 0;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .modal-close:hover {
            color: white;
        }
        /* ===== BOTTOM NAV ===== */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.98);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: none;
            justify-content: space-around;
            .bottom-nav {
    /* KEEP SEMUA PROPERTY LAMA ANDA... */
        /* TAMBAH/EDIT INI SAJA: */
    max-width: 500px;      /* ADD THIS LINE */
    margin: 0 auto;        /* ADD THIS LINE */
        /* JANGAN HAPUS PROPERTY LAINNYA! */
}
            padding: 10px 5px;
            z-index: 1000;
        }
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: rgba(255, 255, 255, 0.5);
            text-decoration: none;
            font-size: 10px;
            padding: 6px 8px;
            transition: all 0.2s;
            min-width: 60px;
            cursor: pointer;
        }
        .nav-item.active {
            color: #4903fc;
        }
        .nav-icon {
            font-size: 16px;
            margin-bottom: 2px;
        }
        .nav-label {
            font-weight: 500;
            letter-spacing: 0.5px;
        }
        /* ===== ANIMATION ===== */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        .fade-in {
            animation: fadeIn 0.3s ease;
        }
        .pulse {
            animation: pulse 1.5s infinite;
        }
        /* ===== CHARACTER COUNTER ===== */
        .char-counter {
            text-align: right;
            font-size: 11px;
            color: rgba(255, 255, 255, 0.4);
            margin-bottom: 10px;
            display: none;
        }
        /* ===== EMOJI BAR BELOW ARTEFAK ===== */
        .artefak-emoji-bar {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 8px 15px;
            margin-top: 6px;
            border-top: 1px solid rgba(73, 3, 252, 0.1);
        }
        .artefak-emoji-buttons {
            display: flex;
            gap: 15px;
        }
        .artefak-emoji-btn {
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.7);
            font-size: 20px;
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 6px;
            transition: all 0.2s;
            position: relative;
        }
        .artefak-emoji-btn:hover {
            color: #4903fc;
            transform: scale(1.1);
        }
        .artefak-emoji-btn.active {
            color: #4903fc;
        }
        .artefak-emoji-btn.has-new {
            animation: pulse 1.5s infinite;
            color: #ff9999;
        }
        .reaction-peek {
            position: relative;
            cursor: pointer;
        }
        .reaction-peek-popup {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.95);
            border: 1px solid rgba(73, 3, 252, 0.3);
            border-radius: 8px;
            padding: 10px;
            min-width: 150px;
            z-index: 100;
            display: none;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
        }
        .reaction-peek-popup.show {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        .reaction-peek-title {
            font-size: 10px;
            color: rgba(73, 3, 252, 0.7);
            margin-bottom: 6px;
            text-align: center;
            font-weight: 600;
        }
        .reaction-user-list {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        .reaction-user-item {
            font-size: 11px;
            color: rgba(255, 255, 255, 0.8);
            padding: 3px 6px;
            border-radius: 4px;
            background: rgba(73, 3, 252, 0.1);
        }
        /* ===== ARTEFAK GRID 3 KOLOM ===== */
        .artefaks-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 20px 0;
        }
        .artefak-grid-item {
            background: rgba(73, 3, 252, 0.03);
            border: 1px solid rgba(73, 3, 252, 0.08);
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s;
            aspect-ratio: 1;
            position: relative;
        }
        .artefak-grid-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(73, 3, 252, 0.15);
        }
        .artefak-grid-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }
        .artefak-grid-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.7);
            padding: 8px;
            transform: translateY(100%);
            transition: transform 0.3s;
        }
        .artefak-grid-item:hover .artefak-grid-overlay {
            transform: translateY(0);
        }
        .artefak-grid-title {
            font-size: 11px;
            font-weight: 600;
            color: white;
            margin-bottom: 2px;
        }
        .artefak-grid-date {
            font-size: 9px;
            color: rgba(255, 255, 255, 0.6);
        }
        /* ===== FILE UPLOAD ===== */
        .file-input-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
        }
        .file-input-wrapper input[type=file] {
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }
        
        /* Modal Unggah Artefak */
        .upload-modal-content {
            max-width: 100%;
        }
        .upload-preview {
            width: 100%;
            height: 250px; /* TINGGI FIXED UNTUK MODAL */
            background: rgba(73, 3, 252, 0.05);
            border: 2px dashed rgba(73, 3, 252, 0.3);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 15px 0;
            overflow: hidden;
        }
        .upload-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            object-position: center;
        }
        .upload-placeholder {
            font-size: 48px;
            color: rgba(73, 3, 252, 0.2);
        }
        .upload-title-input {
            width: 100%;
            background: rgba(73, 3, 252, 0.05);
            border: 1px solid rgba(73, 3, 252, 0.2);
            border-radius: 8px;
            padding: 12px;
            color: white;
            font-family: inherit;
            font-size: 14px;
            margin: 10px 0;
            outline: none;
        }
        .upload-title-input:focus {
            border-color: #4903fc;
        }
        .upload-title-input::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }
        .word-counter {
            text-align: right;
            font-size: 11px;
            color: rgba(255, 255, 255, 0.4);
            margin-bottom: 15px;
        }
        .warning-notice {
            background: rgba(255, 50, 50, 0.1);
            border: 1px solid rgba(255, 50, 50, 0.3);
            border-radius: 8px;
            padding: 12px;
            margin: 15px 0;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
            text-align: center;
            line-height: 1.4;
        }
        .warning-notice strong {
            color: #ff9999;
        }
        /* ===== LOGIN/REGISTER REDESIGN - ADD THESE LINES ===== */
.login-container {
    display: flex;
    flex-direction: column;
    min-height: calc(100vh - 40px);
    justify-content: center;
    align-items: center;
    text-align: center;
}

.logo-small {
    position: absolute;
    top: 20px;
    left: 20px;
    font-size: 28px;
    font-weight: 900;
    color: #ff9999;
    letter-spacing: -2px;
}

.soul-tagline {
    font-size: 22px;
    font-weight: 700;
    line-height: 1.3;
    color: #fff;
    margin-bottom: 40px;
    text-align: center;
    max-width: 280px;
}

.soul-tagline .highlight {
    color: #4903fc;
    font-weight: 800;
    text-shadow: 0 0 10px rgba(73, 3, 252, 0.3);
}

.nope-input-group {
    width: 100%;
    max-width: 300px;
    margin: 0 auto;
}

.nope-input {
    width: 100%;
    background: rgba(20, 20, 20, 0.8);
    border: 1px solid rgba(73, 3, 252, 0.3);
    border-radius: 10px;
    color: white;
    font-size: 16px;
    padding: 16px 20px;
    outline: none;
    font-weight: 400;
    margin-bottom: 15px;
    transition: all 0.3s ease;
    backdrop-filter: blur(10px);
}

.nope-input:focus {
    border-color: #4903fc;
    box-shadow: 0 0 0 2px rgba(73, 3, 252, 0.2);
    background: rgba(30, 30, 30, 0.9);
}

.nope-input::placeholder {
    color: rgba(255, 255, 255, 0.4);
    font-weight: 300;
}

.enter-btn {
    width: 100%;
    max-width: 300px;
    background: linear-gradient(135deg, #4903fc 0%, #7b3fe4 100%);
    border: none;
    color: white;
    font-family: inherit;
    font-size: 16px;
    font-weight: 700;
    padding: 16px;
    border-radius: 10px;
    cursor: pointer;
    transition: all 0.3s ease;
    margin-top: 10px;
    letter-spacing: 0.5px;
    text-transform: uppercase;
}

.enter-btn:hover:not(:disabled) {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(73, 3, 252, 0.3);
    background: linear-gradient(135deg, #5a1cff 0%, #8c50f0 100%);
}

.enter-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    transform: none !important;
}

.legal-hint {
    position: absolute;
    bottom: 30px;
    left: 0;
    right: 0;
    text-align: center;
    color: rgba(255, 255, 255, 0.2);
    font-size: 10px;
    padding: 0 20px;
    line-height: 1.4;
    font-weight: 300;
}
    </style>
</head>
<body>
    <!-- POST MODAL -->
    <div class="modal-overlay" id="modalOverlay">
        <div class="modal" id="modalContent">
            <!-- Modal content will be injected here -->
        </div>
    </div>
    <!-- BOTTOM NAVIGATION -->
    <div class="bottom-nav" id="bottomNav">
        <a href="#" class="nav-item active" onclick="showTab('jejak')">
            <div class="nav-icon">üìù</div>
            <div class="nav-label">Jejak</div>
        </a>
        <a href="#" class="nav-item" onclick="showTab('jalan')">
            <div class="nav-icon">üö∂</div>
            <div class="nav-label">Jalan</div>
        </a>
        <a href="#" class="nav-item" onclick="showTab('dunia')">
            <div class="nav-icon">üåç</div>
            <div class="nav-label">Dunia</div>
        </a>
    </div>
      <!-- LOGIN PAGE - NEW DESIGN -->
<div id="login" class="page active">
    <div class="login-container">
        <!-- Tagline sebagai pusat perhatian -->
        <div class="soul-tagline fade-in">
            Ga perlu followers,<br>
            cuma butuh <span class="highlight">sefrekue<span style="letter-spacing: -1px;">nsi...</span></span>
        </div>
        
        <!-- Logo NOPE di tengah -->
        <div class="logo-center">NOPE</div>
        
        <!-- Input dan tombol -->
        <div class="nope-input-group slide-in">
            <input type="text" 
                   class="nope-input" 
                   id="usernameInput"
                   placeholder="nama_kamu"
                   autocomplete="off"
                   autocapitalize="none"
                   spellcheck="false"
                   maxlength="20">
            <div class="user-status" id="userStatus"></div>
            <button class="enter-btn" onclick="processLogin()" id="loginBtn">
                Gaskeun!
            </button>
        </div>
        
                <!-- Footer legal -->
        <div class="legal-hint">
            Anonim, jangan gunakan nama aslimu
        </div>
    </div>
</div>

    <!-- ONBOARDING PAGE -->
    <div id="onboarding" class="page">
        <div class="logo">NOPE</div>
        <div class="zona-header">
            <div class="zona-title">Pilih 1# dari masing-masing 3 zona</div>
        </div>
        <!-- Zona 1: PopCulture -->
        <div class="zona-card">
            <div class="zona-card-header">
                <div>
                    <div class="zona-card-name">PopCulture</div>
                    <div class="zona-card-desc">Film, musik, meme, tren viral</div>
                </div>
                <div class="zona-card-counter" id="popcultureCounter">0/1</div>
            </div>
            <div class="hashtag-list" id="popcultureList"></div>
        </div>
        <!-- Zona 2: PersonalPain -->
        <div class="zona-card">
            <div class="zona-card-header">
                <div>
                    <div class="zona-card-name">PersonalPain</div>
                    <div class="zona-card-desc">Kecemasan, trauma, healing, self-care</div>
                </div>
                <div class="zona-card-counter" id="personalpainCounter">0/1</div>
            </div>
            <div class="hashtag-list" id="personalpainList"></div>
        </div>
        <!-- Zona 3: SocialSickness -->
        <div class="zona-card">
            <div class="zona-card-header">
                <div>
                    <div class="zona-card-name">SocialSickness</div>
                    <div class="zona-card-desc">Toxic relationship, FOMO, loneliness</div>
                </div>
                <div class="zona-card-counter" id="socialsicknessCounter">0/1</div>
            </div>
            <div class="hashtag-list" id="socialsicknessList"></div>
        </div>
        <!-- Action Button -->
        <button class="action-btn" id="saveBtn" onclick="saveSelections()" disabled>
            Lanjutkan
        </button>
    </div>
    <!-- JEJAK PAGE -->
    <div id="jejak" class="page" style="padding-top: 80px;">
        <div class="logo">NOPE</div>
        
        <!-- Artefak Preview -->
        <div class="artefak-preview-container" id="artefakPreviewContainer"></div>
        
        <!-- Rant Box -->
        <div class="rant-box-container">
            <div class="rant-box-header">
                <div class="rant-box-title">Rant Box</div>
                <div class="rant-box-counter" id="rantCounter">0/300</div>
            </div>
            <textarea 
                class="rant-box" 
                id="rantBox" 
                placeholder="Perasaanmu dalam 300 huruf" 
                maxlength="300" 
                rows="5"
            ></textarea>
            <div class="rant-box-footer">
                <button class="gaskeun-btn" onclick="postRantFromBox()">
                    Gaskeun!
                </button>
            </div>
        </div>
        <!-- Recent Rants -->
        <div class="recent-rants">
            <div class="section-header">
                <div class="section-title">Jejakmu</div>
                <div class="section-view-all" onclick="viewAllRants()">Lihat semua</div>
            </div>
            <div class="recent-rants-list" id="recentRantsList">
                <!-- Recent rants will be populated by JavaScript -->
            </div>
        </div>
        <!-- Artefak Grid 3x2 -->
        <div class="artefaks-grid" id="artefaksGrid">
            <!-- Akan diisi oleh JavaScript -->
        </div>
    </div>
    <!-- JALAN PAGE -->
    <div id="jalan" class="page">
        <div class="logo">NOPE</div>
        <div class="jalan-header">
            <div class="jalan-title">Jalan mu</div>
        </div>
        <!-- Tab Navigation -->
        <div class="jalan-tab-nav">
            <button class="jalan-tab-btn active" onclick="showJalanTab('frekuensi')">Frekuensi</button>
            <button class="jalan-tab-btn" onclick="showJalanTab('gelombang')">Gelombang</button>
            <button class="jalan-tab-btn" onclick="showJalanTab('movement')">Movement</button>
        </div>
        <!-- Frekuensi Tab -->
        <div id="jalan-frekuensi" class="jalan-tab-content">
            <div class="section-header">
                <div class="section-title">3# pilihan mu</div>
            </div>
            <div id="frekuensiFeed" class="recent-rants-list compact">
                <!-- Feed akan diisi dengan artefak visual penuh -->
            </div>
        </div>
        <!-- Gelombang Tab -->
        <div id="jalan-gelombang" class="jalan-tab-content" style="display:none;">
            <div class="section-header">
                <div class="section-title">Gelombang Global</div>
            </div>
            <div id="gelombangFeed" class="recent-rants-list compact">
                <!-- Feed akan diisi dengan artefak visual penuh -->
            </div>
        </div>
        <!-- Movement Tab -->
        <div id="jalan-movement" class="jalan-tab-content" style="display:none;">
            <div class="section-header">
                <div class="section-title">Movement</div>
            </div>
            <div id="movementFeed" class="recent-rants-list compact">
                <!-- Feed akan diisi dengan rant saja -->
            </div>
        </div>
        <!-- Hashtag terpilih -->
        <div class="zona-card" style="margin-top: 15px;">
            <div class="zona-card-header" style="padding-bottom:6px;margin-bottom:8px;">
                <div>
                    <div class="zona-card-name" style="font-size:14px;">Frekuensi mu</div>
                </div>
            </div>
            <div id="selectedHashtagsList" style="display:flex;gap:6px;flex-wrap:wrap;"></div>
        </div>
    </div>
    <!-- DUNIA PAGE -->
    <div id="dunia" class="page">
        <div class="logo">NOPE</div>
        <div class="dunia-header">
            <div class="dunia-title">Dunia mu</div>
            <div class="dunia-subtitle">
                Profil dan pengaturan
            </div>
        </div>
        <div class="profile-card">
            <div class="profile-username" id="profileUsername">@username</div>
            <div class="profile-meta" id="profileJoinDate">Bergabung: -</div>
            <div class="profile-meta" id="profileActivity">Aktivitas: 0 posting</div>
        </div>
        <div class="action-btn" onclick="openArtefakUpload()" style="margin-top: 8px;">
            üìÅ Unggah Artefak
        </div>
        <div class="action-btn secondary" onclick="exportData()" style="margin-top: 8px;">
            üì§ Export Data
        </div>
        <div class="action-btn secondary" onclick="showHashtagsModal()" style="margin-top: 8px;">
            üëÅÔ∏è Lihat # terpilih
        </div>
        <div class="action-btn secondary" onclick="logout()" style="background: rgba(255,50,50,0.1); border-color: rgba(255,50,50,0.3); margin-top: 15px;">
            üö™ Keluar
        </div>
    </div>
    
    <!-- Hidden file input for artefak upload -->
    <input type="file" id="artefakFileInput" accept="image/*" style="display: none;">
    
    <script>
        // ===== STATE =====
        let currentUser = null;
        let currentTab = 'jejak';
        let currentArtefakReactions = {
            nangis: {
                count: 0,
                users: [],
                hasNew: false
            },
            api: {
                count: 0,
                users: [],
                hasNew: false
            },
            badut: {
                count: 0,
                users: [],
                hasNew: false
            }
        };
        
        // State untuk upload artefak
        let artefakUploadState = {
            image: null,
            title: '',
            step: 0 // 0: pilih gambar, 1: tulis judul, 2: konfirmasi
        };
        
        // ===== SELECTED HASHTAGS =====
        let selectedHashtags = {
            popculture: null,
            personalpain: null,
            socialsickness: null
        };
        
        // ===== DATA STRUCTURE =====
        const zonaData = {
            popculture: {
                name: "PopCulture",
                description: "Film, musik, meme, tren viral",
                hashtags: [
                    { name: "#FilmEndingGaje", microcopy: "capek nunggu akhir yang masuk akal. hidup aja nggak pernah adil." },
                    { name: "#InfluencerNgehek", microcopy: "liat konten 'hidup sempurna', pas DM minta endorse malah auto read." },
                    { name: "#BeliTiketJualGinjal", microcopy: "harga tiket konser = 3 bulan gaji magang. tapi hati bilang: worth it." },
                    { name: "#HealingPayLater", microcopy: "self-care pakai cicilan. besok stres, hari ini bahagia dulu." }
                ]
            },
            personalpain: {
                name: "PersonalPain",
                description: "Kecemasan, trauma, healing, self-care",
                hashtags: [
                    { name: "#SayNOPE", microcopy: "bukan sombong. cuma lagi butuh ruang untuk pulih." },
                    { name: "#DiGhostingGebetan", microcopy: "ditinggal tanpa kabar, tapi masih ngecek story-nya tiap malam." },
                    { name: "#CapekPuraPura", microcopy: "senyum di WA, nangis di kamar mandi." },
                    { name: "#DiamDiamNangis", microcopy: "nangis tanpa suara, biar nggak jadi beban buat orang." }
                ]
            },
            socialsickness: {
                name: "SocialSickness",
                description: "Toxic relationship, FOMO, loneliness",
                hashtags: [
                    { name: "#MagangDibayarSerifikat", microcopy: "kerja 8 jam, upahnya cuma kertas yang nggak bisa bayar kos." },
                    { name: "#KeluarWAGroup", microcopy: "tinggalkan grup yang bikin anxiety, bukan kehilangan teman." },
                    { name: "#TemenLambeTurah", microcopy: "curhat dikira rahasia, eh besok jadi bahan gosip." },
                    { name: "#GajianSejamAbis", microcopy: "gajian pagi, siang udah nol. tapi tetap dipanggil 'pelit'." }
                ]
            }
        };
        
        // Dummy foto artefak untuk Gen Z
        const dummyArtefakPhotos = [
            {
                url: "https://images.unsplash.com/photo-1563089145-599997674d42?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
                title: "Late Night Vibes",
                date: "15 Mar 2025",
                username: "diamdiamaja"
            },
            {
                url: "https://images.unsplash.com/photo-1542744095-fcf48d80b0fd?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
                title: "Studio Session",
                date: "12 Mar 2025",
                username: "ghosted_aja"
            },
            {
                url: "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
                title: "Gym Progress",
                date: "10 Mar 2025",
                username: "maganggratis"
            },
            {
                url: "https://images.unsplash.com/photo-1528702748617-c64d49f918af?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
                title: "Cafe Moments",
                date: "08 Mar 2025",
                username: "temenpalsu"
            },
            {
                url: "https://images.unsplash.com/photo-1558618666-fcd25c85cd64?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
                title: "Concert Memory",
                date: "05 Mar 2025",
                username: "konserginjal"
            },
            {
                url: "https://images.unsplash.com/photo-1593115057322-e94b77572f20?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
                title: "Skyline View",
                date: "01 Mar 2025",
                username: "diamdiamaja"
            }
        ];
        
        // ===== STORAGE HELPERS =====
        function getUsers() {
            const usersJson = localStorage.getItem('nope_users');
            return usersJson ? JSON.parse(usersJson) : {};
        }
        
        function saveUsers(users) {
            localStorage.setItem('nope_users', JSON.stringify(users));
        }
        
        function getUserData(username) {
            const users = getUsers();
            return users[username] || null;
        }
        
        function saveUserData(username, data) {
            const users = getUsers();
            users[username] = data;
            saveUsers(users);
        }
        
        function getArtefakReactions() {
            const reactionsJson = localStorage.getItem('nope_artefak_reactions');
            return reactionsJson ? JSON.parse(reactionsJson) : {};
        }
        
        function saveArtefakReactions(reactions) {
            localStorage.setItem('nope_artefak_reactions', JSON.stringify(reactions));
        }
        
        function getGlobalRants() {
            const globalRantsJson = localStorage.getItem('nope_global_rants');
            return globalRantsJson ? JSON.parse(globalRantsJson) : [];
        }
        
        function saveGlobalRants(rants) {
            localStorage.setItem('nope_global_rants', JSON.stringify(rants));
        }
        
        function getGlobalArtefaks() {
            const globalArtefaksJson = localStorage.getItem('nope_global_artefaks');
            return globalArtefaksJson ? JSON.parse(globalArtefaksJson) : [];
        }
        
        function saveGlobalArtefaks(artefaks) {
            localStorage.setItem('nope_global_artefaks', JSON.stringify(artefaks));
        }
        
        // ===== DUMMY DATA INITIALIZATION =====
        function initializeDummyData() {
            const users = getUsers();
            if (Object.keys(users).length > 0) return;
            
            const now = Date.now();
            const dummyUsers = [
                {
                    username: "diamdiamaja",
                    hashtags: ["#SayNOPE", "#CapekPuraPura", "#DiamDiamNangis"],
                    rant: "bilang gue baik-baik aja padahal hati lagi kacau. capek jadi tempat curhat tapi gak pernah boleh curhat.",
                    artefak: {
                        title: "kopi dingin",
                        content: "minum sendirian jam 3 pagi. gajian belum turun, besok bayar kos."
                    }
                },
                {
                    username: "ghosted_aja",
                    hashtags: ["#DiGhostingGebetan", "#CapekPuraPura", "#FilmEndingGaje"],
                    rant: "udah 3 minggu dia ngilang. gue cek story-nya tiap malem. padahal cuma nanya 'udah makan?'",
                    artefak: {
                        title: "notifikasi kosong",
                        content: "kotak chat belum terkirim. niat nanya kabar aja susah."
                    }
                },
                {
                    username: "maganggratis",
                    hashtags: ["#MagangDibayarSerifikat", "#GajianSejamAbis", "#HealingPayLater"],
                    rant: "kerja 9 jam, pulang bawa serifikat. ibu bilang 'itu investasi'. investasi buat apa, bu? buat bayar listrik?",
                    artefak: {
                        title: "serifikat gulung",
                        content: "dikasih frame, tapi gak ada duit buat beli bingkai."
                    }
                },
                {
                    username: "temenpalsu",
                    hashtags: ["#TemenLambeTurah", "#KeluarWAGroup", "#InfluencerNgehek"],
                    rant: "curhat soal gebetan, eh besok jadi bahan gosip di grup. sekarang gue milih sendiri aja.",
                    artefak: {
                        title: "chat terhapus",
                        content: "percaya itu mahal. gue udah bangkrut."
                    }
                },
                {
                    username: "konserginjal",
                    hashtags: ["#BeliTiketJualGinjal", "#HealingPayLater", "#FilmEndingGaje"],
                    rant: "tiket konser habis 1.2 juta. gaji magang 800rb. tapi malam itu gue nangis bahagia. worth it.",
                    artefak: {
                        title: "tiket sobek",
                        content: "masih genggam erat pas pulang naik angkot."
                    }
                }
            ];
            
            // Buat dummy user
            dummyUsers.forEach((user, i) => {
                users[user.username] = {
                    username: user.username,
                    created: now - (15 - i) * 24 * 60 * 60 * 1000,
                    lastLogin: now - (15 - i) * 24 * 60 * 60 * 1000,
                    onboarded: true,
                    selectedHashtags: {
                        popculture: user.hashtags.find(h => zonaData.popculture.hashtags.some(t => t.name === h)) || null,
                        personalpain: user.hashtags.find(h => zonaData.personalpain.hashtags.some(t => t.name === h)) || null,
                        socialsickness: user.hashtags.find(h => zonaData.socialsickness.hashtags.some(t => t.name === h)) || null,
                        movement: user.hashtags.find(h => ["#PendidikanUntukSemua","#JanganExploitBuruh","#FUNDINGSolidaritasDiam","#PetisiTerbuka"].includes(h)) || null
                    },
                    rants: [{
                        content: user.rant,
                        hashtag: user.hashtags[0],
                        date: now - (15 - i) * 24 * 60 * 60 * 1000
                    }],
                    artefacts: [{
                        title: user.artefak.title,
                        content: user.artefak.content,
                        date: now - (15 - i) * 24 * 60 * 60 * 1000 + 10000,
                        imageUrl: dummyArtefakPhotos[i] ? dummyArtefakPhotos[i].url : null
                    }]
                };
            });
            saveUsers(users);
            
            // Inisialisasi dummy reactions
            const reactions = getArtefakReactions();
            if (!reactions['global']) {
                reactions['global'] = {
                    nangis: { count: 3, users: ["diamdiamaja", "ghosted_aja", "maganggratis"], hasNew: true },
                    api: { count: 2, users: ["temenpalsu", "konserginjal"], hasNew: true },
                    badut: { count: 1, users: ["diamdiamaja"], hasNew: false }
                };
                saveArtefakReactions(reactions);
            }
            
            // Inisialisasi global rants
            let globalRants = [];
            dummyUsers.forEach((user, i) => {
                globalRants.push({
                    username: user.username,
                    content: user.rant,
                    hashtag: user.hashtags[0],
                    date: now - (15 - i) * 24 * 60 * 60 * 1000
                });
            });
            saveGlobalRants(globalRants);
            
            // Inisialisasi global artefaks
            let globalArtefaks = [];
            dummyArtefakPhotos.forEach((artefak, i) => {
                globalArtefaks.push({
                    username: artefak.username,
                    title: artefak.title,
                    imageUrl: artefak.url,
                    date: now - (15 - i) * 24 * 60 * 60 * 1000,
                    nobar: i === 0 // Hanya artefak pertama yang punya badge nobar
                });
            });
            saveGlobalArtefaks(globalArtefaks);
        }
        
        // ===== FIXED INIT APP =====
        function initializeApp() {
            initializeDummyData();
            
            localStorage.removeItem('nope_current_user');
            currentUser = null;
            
            showPage('login');
            
            document.querySelectorAll('.page:not(#login)').forEach(p => p.classList.remove('active'));
            
            setupEventListeners();
        }
        
        function setupEventListeners() {
            const rantBox = document.getElementById('rantBox');
            if (rantBox) {
                rantBox.addEventListener('input', function() {
                    const counter = document.getElementById('rantCounter');
                    if (counter) {
                        counter.textContent = `${this.value.length}/300`;
                    }
                });
            }
        }
        
        // ===== SHOW PAGE & TAB =====
        function showPage(pageId) {
            if (pageId !== 'login' && pageId !== 'onboarding' && !currentUser) {
                showPage('login');
                return;
            }
            
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active','fade-in'));
            const p = document.getElementById(pageId);
            if (p) {
                p.classList.add('active','fade-in');
                const nav = document.getElementById('bottomNav');
                if (['jejak','jalan','dunia'].includes(pageId)) {
                    nav.style.display = 'flex';
                    updateNavActive(pageId);
                } else {
                    nav.style.display = 'none';
                }
                switch(pageId) {
                    case 'login': initLoginPage(); break;
                    case 'onboarding': initOnboardingPage(); break;
                    case 'jejak': initJejakPage(); break;
                    case 'jalan': initJalanPage(); break;
                    case 'dunia': initDuniaPage(); break;
                }
            }
        }
        
        function showTab(tabId) { 
            if (!currentUser) {
                showPage('login');
                return;
            }
            showPage(tabId); 
        }
        
        function updateNavActive(activeTab) {
            document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
            const btn = document.querySelector(`.nav-item[onclick*="${activeTab}"]`);
            if (btn) btn.classList.add('active');
        }
        
        // ===== LOGIN =====
        function initLoginPage() {
            const input = document.getElementById('usernameInput');
            const status = document.getElementById('userStatus');
            input.value = '';
            input.focus();
            status.style.display = 'none';
            
            input.onkeydown = null;
            input.oninput = null;
            
            input.addEventListener('keydown', e => { 
                if (e.key === 'Enter') processLogin(); 
            });
            
            input.addEventListener('input', function() {
                let u = this.value.trim().toLowerCase();
                if (u.length < 3) { 
                    status.style.display = 'none'; 
                    return; 
                }
                let f = u.replace(/\s+/g, '_').replace(/[^a-z0-9_]/g, '');
                if (u !== f) this.value = f;
                const d = getUserData(f);
                status.style.display = 'block';
                if (d) {
                    status.textContent = d.onboarded ? 
                        `@${f} sudah ada ‚Ä¢ tekan enter untuk login` : 
                        `@${f} belum onboarding ‚Ä¢ tekan enter untuk lanjut`;
                } else {
                    status.textContent = `@${f} akan dibuat baru`;
                }
            });
        }
        
        function processLogin() {
            let u = document.getElementById('usernameInput').value.trim().toLowerCase();
            if (u.length < 3) { 
                alert('Username minimal 3 karakter!'); 
                return; 
            }
            u = u.replace(/\s+/g, '_').replace(/[^a-z0-9_]/g, '');
            if (u.length < 3) { 
                alert('Username hanya boleh huruf, angka, underscore!'); 
                return; 
            }
            currentUser = u;
            localStorage.setItem('nope_current_user', u);
            let d = getUserData(u);
            if (!d) {
                d = { 
                    username: u, 
                    created: Date.now(), 
                    lastLogin: Date.now(), 
                    selectedHashtags: null, 
                    onboarded: false, 
                    rants: [], 
                    artefacts: [] 
                };
                saveUserData(u, d);
                showPage('onboarding');
            } else {
                d.lastLogin = Date.now();
                saveUserData(u, d);
                showPage(d.onboarded ? 'jejak' : 'onboarding');
            }
        }
        
        // ===== ONBOARDING =====
        function initOnboardingPage() {
            if (!currentUser) return showPage('login');
            const d = getUserData(currentUser);
            if (d && d.onboarded) return showPage('jejak');
            
            selectedHashtags = d && d.selectedHashtags ? { ...d.selectedHashtags } : { 
                popculture: null, 
                personalpain: null, 
                socialsickness: null 
            };
            
            ['popculture','personalpain','socialsickness'].forEach(z => renderHashtags(z));
            updateCounters();
        }
        
        function renderHashtags(z) {
            const c = document.getElementById(z + 'List');
            const zona = zonaData[z];
            c.innerHTML = '';
            zona.hashtags.forEach(h => {
                const sel = selectedHashtags[z] === h.name;
                const div = document.createElement('div');
                div.className = `hashtag-item ${sel ? 'selected' : ''}`;
                div.onclick = () => selectHashtag(z, h.name);
                div.innerHTML = `<div class="hashtag-name">${h.name}</div><div class="hashtag-microcopy">${h.microcopy}</div>`;
                c.appendChild(div);
            });
        }
        
        function selectHashtag(z, h) {
            selectedHashtags[z] = selectedHashtags[z] === h ? null : h;
            renderHashtags(z);
            updateCounters();
        }
        
        function updateCounters() {
            document.getElementById('popcultureCounter').textContent = `${selectedHashtags.popculture ? '1' : '0'}/1`;
            document.getElementById('personalpainCounter').textContent = `${selectedHashtags.personalpain ? '1' : '0'}/1`;
            document.getElementById('socialsicknessCounter').textContent = `${selectedHashtags.socialsickness ? '1' : '0'}/1`;
            const total = Object.values(selectedHashtags).filter(h => h).length;
            document.getElementById('saveBtn').disabled = total !== 3;
        }
        
        function saveSelections() {
            if (!currentUser) return;
            const d = getUserData(currentUser);
            d.selectedHashtags = selectedHashtags;
            d.onboarded = true;
            d.lastLogin = Date.now();
            saveUserData(currentUser, d);
            document.getElementById('saveBtn').textContent = 'Menyimpan...';
            document.getElementById('saveBtn').disabled = true;
            setTimeout(() => showPage('jejak'), 600);
        }
        
        // ===== JEJAK =====
        function initJejakPage() {
            if (!currentUser) return showPage('login');
            const d = getUserData(currentUser);
            setupRantBox();
            renderArtefakPreview();
            renderRecentRants();
            renderArtefakGrid();
            loadArtefakReactions();
        }
        
        function setupRantBox() {
            const box = document.getElementById('rantBox');
            if (box) {
                box.value = '';
                const counter = document.getElementById('rantCounter');
                if (counter) {
                    counter.textContent = '0/300';
                }
            }
        }
        
        function renderArtefakPreview() {
            const c = document.getElementById('artefakPreviewContainer');
            if (!c) return;
            
            const d = getUserData(currentUser);
            
            let artefakHtml = '';
            
            if (!d.artefacts || d.artefacts.length === 0) {
                artefakHtml = `
                    <div class="artefak-preview">
                        <div class="artefak-preview-image">
                            <div class="artefak-placeholder">üñºÔ∏è</div>
                            <!-- Badge Nobar di kiri atas -->
                            <div class="artefak-nobar-badge">Nobar terakhir sama mantan</div>
                            <!-- CTA Unggah di kiri bawah -->
                            <button class="upload-process-cta" onclick="openArtefakUpload()">
                                Unggah proses
                            </button>
                        </div>
                        <div class="artefak-preview-info">
                            <div class="artefak-preview-title">üìÅ Belum ada artefak</div>
                            <div class="artefak-preview-date">Klik "Unggah proses" untuk menambahkan artefak</div>
                        </div>
                        ${renderArtefakEmojiBar()}
                    </div>`;
            } else {
                const latest = d.artefacts[d.artefacts.length - 1];
                const date = new Date(latest.date).toLocaleDateString('id-ID', { day: 'numeric', month: 'long', year: 'numeric' });
                
                artefakHtml = `
                    <div class="artefak-preview">
                        <div class="artefak-preview-image">
                            ${latest.imageUrl ? 
                                `<img src="${latest.imageUrl}" alt="${latest.title}">` : 
                                `<div class="artefak-placeholder">üìÅ</div>`
                            }
                            <!-- Badge Nobar di kiri atas -->
                            <div class="artefak-nobar-badge">Nobar terakhir sama mantan</div>
                            <!-- CTA Unggah di kiri bawah -->
                            <button class="upload-process-cta" onclick="openArtefakUpload()">
                                Unggah proses
                            </button>
                        </div>
                        <div class="artefak-preview-info">
                            <div class="artefak-preview-title">üìÅ ${latest.title}</div>
                            <div class="artefak-preview-date">Ditambahkan: ${date}</div>
                        </div>
                        ${renderArtefakEmojiBar()}
                    </div>`;
            }
            
            c.innerHTML = artefakHtml;
        }
        
        function renderArtefakEmojiBar() {
            const reactions = getArtefakReactions()['global'] || currentArtefakReactions;
            
            return `
                <div class="artefak-emoji-bar">
                    <div class="artefak-emoji-buttons">
                        <!-- Nangis -->
                        <div class="reaction-peek">
                            <button class="artefak-emoji-btn ${reactions.nangis.hasNew ? 'has-new' : ''}" 
                                    onclick="reactToArtefak('nangis')" 
                                    title="Nangis">
                                üò≠
                            </button>
                            <div class="reaction-peek-popup" id="nangisPeekPopup">
                                <div class="reaction-peek-title">üò≠ Nangis</div>
                                <div class="reaction-user-list" id="nangisUserList"></div>
                            </div>
                        </div>
                        
                        <!-- Api -->
                        <div class="reaction-peek">
                            <button class="artefak-emoji-btn ${reactions.api.hasNew ? 'has-new' : ''}" 
                                    onclick="reactToArtefak('api')" 
                                    title="Api">
                                üî•
                            </button>
                            <div class="reaction-peek-popup" id="apiPeekPopup">
                                <div class="reaction-peek-title">üî• Api</div>
                                <div class="reaction-user-list" id="apiUserList"></div>
                            </div>
                        </div>
                        
                        <!-- Badut -->
                        <div class="reaction-peek">
                            <button class="artefak-emoji-btn ${reactions.badut.hasNew ? 'has-new' : ''}" 
                                    onclick="reactToArtefak('badut')" 
                                    title="Badut">
                                ü§°
                            </button>
                            <div class="reaction-peek-popup" id="badutPeekPopup">
                                <div class="reaction-peek-title">ü§° Badut</div>
                                <div class="reaction-user-list" id="badutUserList"></div>
                            </div>
                        </div>
                    </div>
                </div>`;
        }
        
        function loadArtefakReactions() {
            const reactions = getArtefakReactions();
            if (reactions['global']) {
                currentArtefakReactions = reactions['global'];
            }
            
            updateReactionPeekPopups();
        }
        
        function updateReactionPeekPopups() {
            const nangisUsers = currentArtefakReactions.nangis.users.slice(0, 5);
            const nangisList = document.getElementById('nangisUserList');
            if (nangisList) {
                nangisList.innerHTML = nangisUsers.map(user => 
                    `<div class="reaction-user-item">@${user}</div>`
                ).join('');
                if (nangisUsers.length === 0) {
                    nangisList.innerHTML = '<div class="reaction-user-item" style="color: rgba(255,255,255,0.5); font-style: italic;">Belum ada reaksi</div>';
                }
            }
            
            const apiUsers = currentArtefakReactions.api.users.slice(0, 5);
            const apiList = document.getElementById('apiUserList');
            if (apiList) {
                apiList.innerHTML = apiUsers.map(user => 
                    `<div class="reaction-user-item">@${user}</div>`
                ).join('');
                if (apiUsers.length === 0) {
                    apiList.innerHTML = '<div class="reaction-user-item" style="color: rgba(255,255,255,0.5); font-style: italic;">Belum ada reaksi</div>';
                }
            }
            
            const badutUsers = currentArtefakReactions.badut.users.slice(0, 5);
            const badutList = document.getElementById('badutUserList');
            if (badutList) {
                badutList.innerHTML = badutUsers.map(user => 
                    `<div class="reaction-user-item">@${user}</div>`
                ).join('');
                if (badutUsers.length === 0) {
                    badutList.innerHTML = '<div class="reaction-user-item" style="color: rgba(255,255,255,0.5); font-style: italic;">Belum ada reaksi</div>';
                }
            }
            
            setupPeekPopups();
        }
        
        function setupPeekPopups() {
            document.querySelectorAll('.reaction-peek').forEach(peek => {
                const btn = peek.querySelector('.artefak-emoji-btn');
                const popup = peek.querySelector('.reaction-peek-popup');
                
                if (btn && popup) {
                    btn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const isShowing = popup.classList.contains('show');
                        
                        document.querySelectorAll('.reaction-peek-popup').forEach(p => {
                            p.classList.remove('show');
                        });
                        
                        if (!isShowing) {
                            popup.classList.add('show');
                        }
                    });
                    
                    document.addEventListener('click', (e) => {
                        if (!peek.contains(e.target)) {
                            popup.classList.remove('show');
                        }
                    });
                }
            });
        }
        
        function renderArtefakGrid() {
            const c = document.getElementById('artefaksGrid');
            if (!c) return;
            
            c.innerHTML = '';
            
            const d = getUserData(currentUser);
            const userArtefaks = d.artefacts || [];
            
            if (userArtefaks.length === 0) {
                dummyArtefakPhotos.forEach(photo => {
                    const div = document.createElement('div');
                    div.className = 'artefak-grid-item';
                    div.onclick = () => showArtefakDetails(photo);
                    div.innerHTML = `
                        <img src="${photo.url}" alt="${photo.title}" class="artefak-grid-image" loading="lazy">
                        <div class="artefak-grid-overlay">
                            <div class="artefak-grid-title">${photo.title}</div>
                            <div class="artefak-grid-date">${photo.date}</div>
                        </div>
                    `;
                    c.appendChild(div);
                });
            } else {
                userArtefaks.forEach(artefak => {
                    const date = new Date(artefak.date).toLocaleDateString('id-ID', { day: 'numeric', month: 'short', year: 'numeric' });
                    const div = document.createElement('div');
                    div.className = 'artefak-grid-item';
                    div.onclick = () => showArtefakDetails(artefak);
                    div.innerHTML = `
                        ${artefak.imageUrl ? 
                            `<img src="${artefak.imageUrl}" alt="${artefak.title}" class="artefak-grid-image" loading="lazy">` :
                            `<div style="width:100%;height:100%;display:flex;align-items:center;justify-content:center;background:rgba(73,3,252,0.1);">üìÅ</div>`
                        }
                        <div class="artefak-grid-overlay">
                            <div class="artefak-grid-title">${artefak.title}</div>
                            <div class="artefak-grid-date">${date}</div>
                        </div>
                    `;
                    c.appendChild(div);
                });
            }
        }
        
        function showArtefakDetails(artefak) {
            const date = new Date(artefak.date).toLocaleDateString('id-ID', { 
                day: 'numeric', 
                month: 'long', 
                year: 'numeric',
                hour: '2-digit', 
                minute: '2-digit' 
            });
            
            const modalOverlay = document.getElementById('modalOverlay');
            const modal = document.getElementById('modalContent');
            
            modal.innerHTML = `
                <div class="modal-header">
                    <div class="modal-title">${artefak.title}</div>
                    <button class="modal-close" onclick="hideModal()">&times;</button>
                </div>
                <div style="padding: 15px 0;">
                    <div style="font-size: 11px; color: rgba(73,3,252,0.7); margin-bottom: 10px;">
                        ${date} ‚Ä¢ @${artefak.username || currentUser}
                    </div>
                    ${artefak.imageUrl ? 
                        `<div style="width:100%;height:250px;background:rgba(73,3,252,0.05);border-radius:10px;overflow:hidden;margin-bottom:15px;">
                            <img src="${artefak.imageUrl}" alt="${artefak.title}" style="width:100%;height:100%;object-fit:cover;">
                        </div>` : 
                        ''
                    }
                    ${artefak.content ? 
                        `<div style="font-size: 14px; line-height: 1.6; color: white; margin-bottom: 20px;">
                            ${artefak.content}
                        </div>` : 
                        ''
                    }
                    <div style="display: flex; gap: 10px; margin-top: 20px;">
                        <button class="action-btn secondary" onclick="hideModal()" style="flex: 1;">
                            Tutup
                        </button>
                    </div>
                </div>
            `;
            
            modalOverlay.classList.add('active');
        }
        
        function renderRecentRants() {
            const c = document.getElementById('recentRantsList');
            if (!c) return;
            
            const d = getUserData(currentUser);
            if (!d.rants || d.rants.length === 0) {
                const dummyRants = [
                    { content: "Gue juga ngerasain... capek banget. Kadang pengen nangis aja.", date: Date.now() - 3600000, hashtag: "#CapekPuraPura" },
                    { content: "Gue ngerasain kayak dijebak sama hidup. Kerjaan banyak, gaji kecil, bos galak, pacar ngilang. Kayaknya gue harus istirahat dulu.", date: Date.now() - 7200000, hashtag: "#SayNOPE" },
                    { content: "Hari ini gue ngerasain semua emosi sekaligus. Senang karena dapet kerjaan baru, sedih karena harus tinggalin rumah, takut karena belum siap, dan marah karena gak ada yang ngerti. Mungkin ini namanya dewasa? Atau cuma kelelahan?", date: Date.now() - 10800000, hashtag: "#DiamDiamNangis" }
                ];
                c.innerHTML = '';
                dummyRants.forEach(r => {
                    const date = new Date(r.date).toLocaleDateString('id-ID', { day: 'numeric', month: 'short', hour: '2-digit', minute: '2-digit' });
                    const content = r.content.length > 100 ? r.content.substring(0, 100) + '...' : r.content;
                    const div = document.createElement('div');
                    div.className = 'recent-rant-item';
                    div.onclick = () => viewRantDetails(r);
                    div.innerHTML = `<div class="recent-rant-date">${date} ‚Ä¢ ${r.hashtag || ''}</div><div class="recent-rant-content">${content}</div>`;
                    c.appendChild(div);
                });
                return;
            }
            const rants = d.rants.slice(-3).reverse();
            c.innerHTML = '';
            rants.forEach(r => {
                const date = new Date(r.date).toLocaleDateString('id-ID', { day: 'numeric', month: 'short', hour: '2-digit', minute: '2-digit' });
                const content = r.content.length > 100 ? r.content.substring(0, 100) + '...' : r.content;
                const div = document.createElement('div');
                div.className = 'recent-rant-item';
                div.onclick = () => viewRantDetails(r);
                div.innerHTML = `<div class="recent-rant-date">${date} ‚Ä¢ ${r.hashtag || ''}</div><div class="recent-rant-content">${content}</div>`;
                c.appendChild(div);
            });
        }
        
        function postRantFromBox() {
            const box = document.getElementById('rantBox');
            if (!box) return;
            
            const content = box.value.trim();
            if (!content) { 
                showToast('Tulis rant terlebih dahulu!'); 
                return; 
            }
            if (!currentUser) return;
            
            const d = getUserData(currentUser);
            if (!d.rants) d.rants = [];
            
            const hashtags = Object.values(d.selectedHashtags).filter(h => h);
            const randomHashtag = hashtags.length > 0 ? 
                hashtags[Math.floor(Math.random() * hashtags.length)] : 
                null;
            
            const newRant = {
                content, 
                date: Date.now(),
                hashtag: randomHashtag 
            };
            
            d.rants.push(newRant);
            d.lastLogin = Date.now();
            saveUserData(currentUser, d);
            
            const globalRants = getGlobalRants();
            globalRants.push({
                username: currentUser,
                ...newRant
            });
            saveGlobalRants(globalRants);
            
            box.value = '';
            const counter = document.getElementById('rantCounter');
            if (counter) {
                counter.textContent = '0/300';
            }
            
            renderRecentRants();
            
            if (currentTab === 'jalan') {
                initJalanPage();
            }
            
            showToast('Rant berhasil diposting!');
        }
        
        // ===== SISTEM UNGGAH ARTEFAK =====
        function openArtefakUpload() {
            artefakUploadState = {
                image: null,
                title: '',
                step: 0
            };
            
            const fileInput = document.getElementById('artefakFileInput');
            fileInput.onchange = handleImageSelect;
            fileInput.click();
        }
        
        function handleImageSelect(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            if (!file.type.match('image.*')) {
                alert('Hanya file gambar yang diperbolehkan!');
                return;
            }
            
            if (file.size > 5 * 1024 * 1024) {
                alert('Ukuran file maksimal 5MB!');
                return;
            }
            
            const reader = new FileReader();
            
            reader.onload = function(e) {
                artefakUploadState.image = e.target.result;
                artefakUploadState.step = 1;
                showArtefakUploadModal();
            };
            
            reader.onerror = function() {
                alert('Gagal membaca file!');
            };
            
            reader.readAsDataURL(file);
        }
        
        function showArtefakUploadModal() {
            const modalOverlay = document.getElementById('modalOverlay');
            const modal = document.getElementById('modalContent');
            
            if (artefakUploadState.step === 1) {
                modal.innerHTML = `
                    <div class="modal-header">
                        <div class="modal-title">Tulis tentang foto ini</div>
                        <button class="modal-close" onclick="hideModal()">&times;</button>
                    </div>
                    <div class="upload-modal-content">
                        <div class="upload-preview">
                            ${artefakUploadState.image ? 
                                `<img src="${artefakUploadState.image}" alt="Preview">` : 
                                `<div class="upload-placeholder">üñºÔ∏è</div>`
                            }
                        </div>
                        <input type="text" 
                               class="upload-title-input" 
                               id="artefakTitleInputModal"
                               placeholder="Maksimum 4 kata tentang foto ini"
                               maxlength="50"
                               value="${artefakUploadState.title}"
                               oninput="updateArtefakTitle()">
                        <div class="word-counter" id="wordCounter">0/4 kata</div>
                        <div class="action-btn" onclick="proceedToConfirmation()" id="nextBtn" disabled>
                            Lanjut
                        </div>
                        <button class="action-btn secondary" onclick="hideModal()" style="margin-top: 8px;">
                            Batal
                        </button>
                    </div>
                `;
                
                const titleInput = document.getElementById('artefakTitleInputModal');
                if (titleInput) {
                    titleInput.focus();
                    updateArtefakTitle();
                }
            } else if (artefakUploadState.step === 2) {
                modal.innerHTML = `
                    <div class="modal-header">
                        <div class="modal-title">Konfirmasi Unggah</div>
                        <button class="modal-close" onclick="hideModal()">&times;</button>
                    </div>
                    <div class="upload-modal-content">
                        <div class="warning-notice">
                            <strong>‚ö†Ô∏è PERINGATAN</strong><br>
                            Artefakmu akan tersimpan <strong>selamanya</strong> dan <strong>tidak bisa dihapus</strong>.
                        </div>
                        <div class="upload-preview">
                            ${artefakUploadState.image ? 
                                `<img src="${artefakUploadState.image}" alt="Preview">` : 
                                `<div class="upload-placeholder">üñºÔ∏è</div>`
                            }
                        </div>
                        <div style="background: rgba(73,3,252,0.1); padding: 12px; border-radius: 8px; margin: 15px 0;">
                            <div style="font-size: 14px; font-weight: 600; color: #4903fc; margin-bottom: 5px;">
                                ${artefakUploadState.title || '(tanpa judul)'}
                            </div>
                        </div>
                        <div class="action-btn" onclick="uploadArtefak()">
                            ‚úÖ Ya, Unggah Artefak
                        </div>
                        <button class="action-btn secondary" onclick="artefakUploadState.step = 1; showArtefakUploadModal()" style="margin-top: 8px;">
                            ‚Ü∂ Kembali
                        </button>
                    </div>
                `;
            }
            
            modalOverlay.classList.add('active');
        }
        
        function updateArtefakTitle() {
            const input = document.getElementById('artefakTitleInputModal');
            if (!input) return;
            
            artefakUploadState.title = input.value.trim();
            
            const words = artefakUploadState.title.split(/\s+/).filter(word => word.length > 0);
            const wordCount = words.length;
            
            const counter = document.getElementById('wordCounter');
            if (counter) {
                counter.textContent = `${wordCount}/4 kata`;
                counter.style.color = wordCount > 4 ? '#ff3333' : 'rgba(255, 255, 255, 0.4)';
            }
            
            const nextBtn = document.getElementById('nextBtn');
            if (nextBtn) {
                nextBtn.disabled = wordCount > 4 || wordCount === 0;
            }
            
            if (wordCount > 4) {
                const trimmed = words.slice(0, 4).join(' ');
                input.value = trimmed;
                artefakUploadState.title = trimmed;
            }
        }
        
        function proceedToConfirmation() {
            if (artefakUploadState.title.trim() === '') {
                showToast('Harap tulis judul untuk artefak!');
                return;
            }
            
            const words = artefakUploadState.title.split(/\s+/).filter(word => word.length > 0);
            if (words.length > 4) {
                showToast('Maksimum 4 kata untuk judul artefak!');
                return;
            }
            
            artefakUploadState.step = 2;
            showArtefakUploadModal();
        }
        
        function uploadArtefak() {
            if (!currentUser || !artefakUploadState.image) return;
            
            const d = getUserData(currentUser);
            if (!d.artefacts) d.artefacts = [];
            
            const newArtefak = {
                title: artefakUploadState.title || 'Artefak Baru',
                imageUrl: artefakUploadState.image,
                date: Date.now(),
                username: currentUser,
                nobar: true // Selalu ada badge nobar untuk artefak baru
            };
            
            d.artefacts.push(newArtefak);
            d.lastLogin = Date.now();
            saveUserData(currentUser, d);
            
            const globalArtefaks = getGlobalArtefaks();
            globalArtefaks.push(newArtefak);
            saveGlobalArtefaks(globalArtefaks);
            
            document.getElementById('artefakFileInput').value = '';
            
            hideModal();
            
            renderArtefakPreview();
            renderArtefakGrid();
            
            if (currentTab === 'jalan') {
                initJalanPage();
            }
            
            showToast('Artefak berhasil diupload! Tersimpan selamanya.');
            
            artefakUploadState = {
                image: null,
                title: '',
                step: 0
            };
        }
        
        function reactToArtefak(reactionType) {
            if (!currentUser) return;
            
            const reactions = getArtefakReactions();
            if (!reactions['global']) {
                reactions['global'] = JSON.parse(JSON.stringify(currentArtefakReactions));
            }
            
            const userReactions = reactions['global'];
            
            if (!userReactions[reactionType].users.includes(currentUser)) {
                userReactions[reactionType].count++;
                userReactions[reactionType].users.push(currentUser);
                userReactions[reactionType].hasNew = true;
                
                saveArtefakReactions(reactions);
                currentArtefakReactions = userReactions;
                
                renderArtefakPreview();
                showToast(`Kamu bereaksi dengan ${reactionType}!`);
            } else {
                showToast(`Kamu sudah bereaksi dengan ${reactionType}`);
            }
        }
        
        // ===== JALAN =====
        function initJalanPage() {
            if (!currentUser) return showPage('login');
            const d = getUserData(currentUser);
            renderSelectedHashtags();
            renderFrekuensiFeed();
            renderGelombangFeed();
            renderMovementFeed();
            showJalanTab('frekuensi');
        }
        
        function renderSelectedHashtags() {
            const c = document.getElementById('selectedHashtagsList');
            if (!c) return;
            
            const d = getUserData(currentUser);
            if (!d.selectedHashtags) {
                c.innerHTML = '<div class="hint">Belum memilih hashtag</div>';
                return;
            }
            c.innerHTML = '';
            Object.entries(d.selectedHashtags).forEach(([z, h]) => {
                if (h) {
                    const span = document.createElement('span');
                    span.style.padding = '4px 8px';
                    span.style.background = 'rgba(73, 3, 252, 0.1)';
                    span.style.borderRadius = '6px';
                    span.style.fontSize = '12px';
                    span.style.color = '#4903fc';
                    span.textContent = h;
                    c.appendChild(span);
                }
            });
        }
        
        function showJalanTab(tab) {
            ['frekuensi','gelombang','movement'].forEach(t => {
                const element = document.getElementById(`jalan-${t}`);
                if (element) {
                    element.style.display = t === tab ? 'block' : 'none';
                }
            });
            document.querySelectorAll('.jalan-tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
        }
        
        function renderFrekuensiFeed() {
            const c = document.getElementById('frekuensiFeed');
            if (!c) return;
            
            const d = getUserData(currentUser);
            if (!d.selectedHashtags) return;
            
            const allUsers = getUsers();
            let filteredItems = [];
            
            // 1. Artefak dari user dengan hashtag yang sama (VISUAL PENUH)
            const globalArtefaks = getGlobalArtefaks();
            globalArtefaks.forEach(artefak => {
                const user = getUserData(artefak.username);
                if (user && user.selectedHashtags) {
                    Object.values(user.selectedHashtags).forEach(hashtag => {
                        Object.values(d.selectedHashtags).forEach(userHashtag => {
                            if (hashtag && userHashtag && hashtag === userHashtag) {
                                filteredItems.push({
                                    type: 'artefak',
                                    ...artefak
                                });
                            }
                        });
                    });
                }
            });
            
            // 2. Rant dengan hashtag yang sama
            Object.values(allUsers).forEach(user => {
                if (user.rants) {
                    user.rants.forEach(rant => {
                        Object.values(d.selectedHashtags).forEach(hashtag => {
                            if (hashtag && rant.hashtag === hashtag) {
                                filteredItems.push({
                                    type: 'rant',
                                    ...rant,
                                    username: user.username
                                });
                            }
                        });
                    });
                }
            });
            
            filteredItems.sort((a, b) => b.date - a.date);
            const items = filteredItems.slice(0, 10);
            
            c.innerHTML = '';
            
            if (items.length === 0) {
                c.innerHTML = '<div class="hint" style="text-align:center;padding:20px;color:rgba(73,3,252,0.5)">Belum ada konten dengan hashtag yang kamu pilih</div>';
                return;
            }
            
            items.forEach(item => {
                const date = new Date(item.date).toLocaleDateString('id-ID', { 
                    day: 'numeric', 
                    month: 'short', 
                    hour: '2-digit', 
                    minute: '2-digit' 
                });
                
                if (item.type === 'artefak') {
                    // ARTEFAK VISUAL PENUH
                    const div = document.createElement('div');
                    div.className = 'artefak-feed-item';
                    div.onclick = () => showArtefakDetails(item);
                    div.innerHTML = `
                        <div class="artefak-feed-image">
                            <img src="${item.imageUrl || 'https://images.unsplash.com/photo-1563089145-599997674d42?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80'}" alt="${item.title}">
                            ${item.nobar ? '<div class="artefak-nobar-badge" style="top:10px;left:10px;">Nobar terakhir sama mantan</div>' : ''}
                        </div>
                        <div class="artefak-feed-info">
                            <div class="artefak-feed-username">üñºÔ∏è @${item.username} ‚Ä¢ ${date}</div>
                            <div class="artefak-feed-title">${item.title}</div>
                            <div class="rant-actions">
                                <div class="rant-emoji-bar">
                                    <button class="emoji-btn" onclick="reactToArtefakFromFeed('nangis', event)">üò≠</button>
                                    <button class="emoji-btn" onclick="reactToArtefakFromFeed('api', event)">üî•</button>
                                    <button class="emoji-btn" onclick="reactToArtefakFromFeed('badut', event)">ü§°</button>
                                </div>
                                <span style="font-size:10px;color:rgba(255,255,255,0.5)">üñºÔ∏è Artefak</span>
                            </div>
                        </div>
                    `;
                    c.appendChild(div);
                } else if (item.type === 'rant') {
                    const content = item.content.length > 120 ? item.content.substring(0, 120) + '...' : item.content;
                    
                    const div = document.createElement('div');
                    div.className = 'recent-rant-item compact';
                    div.innerHTML = `
                        <div class="recent-rant-date compact">üìù @${item.username} ‚Ä¢ ${date} ‚Ä¢ ${item.hashtag || ''}</div>
                        <div class="recent-rant-content compact">${content}</div>
                        <div class="rant-actions">
                            <div class="rant-emoji-bar">
                                <button class="emoji-btn" onclick="reactToRant('‚ù§Ô∏è', this)">‚ù§Ô∏è</button>
                                <button class="emoji-btn" onclick="reactToRant('üòÇ', this)">üòÇ</button>
                                <button class="emoji-btn" onclick="reactToRant('üò≠', this)">üò≠</button>
                            </div>
                            <span style="font-size:10px;color:rgba(255,255,255,0.5)">üí¨ 0</span>
                        </div>
                    `;
                    c.appendChild(div);
                }
            });
        }
        
        function reactToArtefakFromFeed(reactionType, event) {
            event.stopPropagation();
            reactToArtefak(reactionType);
        }
        
        function renderGelombangFeed() {
            const c = document.getElementById('gelombangFeed');
            if (!c) return;
            
            const globalArtefaks = getGlobalArtefaks();
            const globalRants = getGlobalRants();
            
            let allItems = [];
            
            // ARTEFAK VISUAL PENUH di atas
            globalArtefaks.forEach(artefak => {
                allItems.push({
                    type: 'artefak',
                    ...artefak
                });
            });
            
            globalRants.forEach(rant => {
                allItems.push({
                    type: 'rant',
                    ...rant
                });
            });
            
            allItems.sort((a, b) => b.date - a.date);
            const items = allItems.slice(0, 15); // Ambil lebih banyak untuk mix yang baik
            
            c.innerHTML = '';
            
            if (items.length === 0) {
                c.innerHTML = '<div class="hint" style="text-align:center;padding:20px;color:rgba(73,3,252,0.5)">Belum ada konten di gelombang</div>';
                return;
            }
            
            // Urutkan dengan artefak lebih prioritas
            items.sort((a, b) => {
                if (a.type === 'artefak' && b.type !== 'artefak') return -1;
                if (a.type !== 'artefak' && b.type === 'artefak') return 1;
                return b.date - a.date;
            });
            
            const displayItems = items.slice(0, 10);
            
            displayItems.forEach(item => {
                const date = new Date(item.date).toLocaleDateString('id-ID', { 
                    day: 'numeric', 
                    month: 'short', 
                    hour: '2-digit', 
                    minute: '2-digit' 
                });
                
                if (item.type === 'artefak') {
                    // ARTEFAK VISUAL PENUH
                    const div = document.createElement('div');
                    div.className = 'artefak-feed-item';
                    div.onclick = () => showArtefakDetails(item);
                    div.innerHTML = `
                        <div class="artefak-feed-image">
                            <img src="${item.imageUrl || 'https://images.unsplash.com/photo-1563089145-599997674d42?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80'}" alt="${item.title}">
                            ${item.nobar ? '<div class="artefak-nobar-badge" style="top:10px;left:10px;">Nobar terakhir sama mantan</div>' : ''}
                        </div>
                        <div class="artefak-feed-info">
                            <div class="artefak-feed-username">üñºÔ∏è @${item.username} ‚Ä¢ ${date}</div>
                            <div class="artefak-feed-title">${item.title}</div>
                            <div class="rant-actions">
                                <div class="rant-emoji-bar">
                                    <button class="emoji-btn" onclick="reactToArtefakFromFeed('nangis', event)">üò≠</button>
                                    <button class="emoji-btn" onclick="reactToArtefakFromFeed('api', event)">üî•</button>
                                    <button class="emoji-btn" onclick="reactToArtefakFromFeed('badut', event)">ü§°</button>
                                </div>
                                <span style="font-size:10px;color:rgba(255,255,255,0.5)">üñºÔ∏è Artefak</span>
                            </div>
                        </div>
                    `;
                    c.appendChild(div);
                } else if (item.type === 'rant') {
                    const content = item.content.length > 120 ? item.content.substring(0, 120) + '...' : item.content;
                    
                    const div = document.createElement('div');
                    div.className = 'recent-rant-item compact';
                    div.innerHTML = `
                        <div class="recent-rant-date compact">üìù @${item.username} ‚Ä¢ ${date} ‚Ä¢ ${item.hashtag || ''}</div>
                        <div class="recent-rant-content compact">${content}</div>
                        <div class="rant-actions">
                            <div class="rant-emoji-bar">
                                <button class="emoji-btn" onclick="reactToRant('‚ù§Ô∏è', this)">‚ù§Ô∏è</button>
                                <button class="emoji-btn" onclick="reactToRant('üòÇ', this)">üòÇ</button>
                                <button class="emoji-btn" onclick="reactToRant('üò≠', this)">üò≠</button>
                            </div>
                            <span style="font-size:10px;color:rgba(255,255,255,0.5)">üí¨ 0</span>
                        </div>
                    `;
                    c.appendChild(div);
                }
            });
        }
        
        function renderMovementFeed() {
            const c = document.getElementById('movementFeed');
            if (!c) return;
            
            const movementHashtags = ["#PendidikanUntukSemua", "#JanganExploitBuruh", "#FUNDINGSolidaritasDiam", "#PetisiTerbuka"];
            
            const globalRants = getGlobalRants();
            let movementRants = [];
            
            globalRants.forEach(rant => {
                if (movementHashtags.includes(rant.hashtag)) {
                    movementRants.push({
                        type: 'rant',
                        ...rant
                    });
                }
            });
            
            movementRants.sort((a, b) => b.date - a.date);
            const items = movementRants.slice(0, 10);
            
            c.innerHTML = '';
            
            if (items.length === 0) {
                c.innerHTML = '<div class="hint" style="text-align:center;padding:20px;color:rgba(73,3,252,0.5)">Belum ada rant movement</div>';
                return;
            }
            
            items.forEach(item => {
                const date = new Date(item.date).toLocaleDateString('id-ID', { 
                    day: 'numeric', 
                    month: 'short', 
                    hour: '2-digit', 
                    minute: '2-digit' 
                });
                const content = item.content.length > 120 ? item.content.substring(0, 120) + '...' : item.content;
                
                const div = document.createElement('div');
                div.className = 'recent-rant-item compact';
                div.innerHTML = `
                    <div class="recent-rant-date compact">‚úä @${item.username} ‚Ä¢ ${date} ‚Ä¢ ${item.hashtag || ''}</div>
                    <div class="recent-rant-content compact">${content}</div>
                    <div class="rant-actions">
                        <div class="rant-emoji-bar">
                            <button class="emoji-btn" onclick="reactToRant('‚ù§Ô∏è', this)">‚ù§Ô∏è</button>
                            <button class="emoji-btn" onclick="reactToRant('üëç', this)">üëç</button>
                            <button class="emoji-btn" onclick="reactToRant('‚úä', this)">‚úä</button>
                        </div>
                        <span style="font-size:10px;color:rgba(255,255,255,0.5)">üí¨ 0</span>
                    </div>
                `;
                c.appendChild(div);
            });
        }
        
        // ===== DUNIA =====
        function initDuniaPage() {
            if (!currentUser) return showPage('login');
            const d = getUserData(currentUser);
            
            document.getElementById('profileUsername').textContent = '@' + currentUser;
            document.getElementById('profileJoinDate').textContent = 'Bergabung: ' + new Date(d.created).toLocaleDateString('id-ID');
            document.getElementById('profileActivity').textContent = 'Aktivitas: ' + (d.rants ? d.rants.length : 0) + ' posting, ' + (d.artefacts ? d.artefacts.length : 0) + ' artefak';
        }
        
        // ===== UTILITIES =====
        function showToast(message) {
            const t = document.createElement('div');
            t.style.cssText = `position:fixed;top:20px;left:50%;transform:translateX(-50%);background:rgba(73, 3, 252, 0.9);color:white;padding:12px 20px;border-radius:8px;font-size:14px;font-weight:500;z-index:10000;animation:fadeIn 0.3s ease;`;
            t.textContent = message;
            document.body.appendChild(t);
            setTimeout(() => {
                t.style.opacity = '0';
                t.style.transition = 'opacity 0.3s ease';
                setTimeout(() => document.body.removeChild(t), 300);
            }, 3000);
        }
        
        function viewRantDetails(rant) {
            const date = new Date(rant.date).toLocaleDateString('id-ID', { 
                day: 'numeric', 
                month: 'long', 
                year: 'numeric',
                hour: '2-digit', 
                minute: '2-digit' 
            });
            
            const modalOverlay = document.getElementById('modalOverlay');
            const modal = document.getElementById('modalContent');
            
            modal.innerHTML = `
                <div class="modal-header">
                    <div class="modal-title">Detail Rant</div>
                    <button class="modal-close" onclick="hideModal()">&times;</button>
                </div>
                <div style="padding: 15px 0;">
                    <div style="font-size: 11px; color: rgba(73,3,252,0.7); margin-bottom: 10px;">
                        ${date} ${rant.hashtag ? '‚Ä¢ ' + rant.hashtag : ''}
                    </div>
                    <div style="font-size: 14px; line-height: 1.6; color: white; margin-bottom: 20px;">
                        ${rant.content}
                    </div>
                    <div style="display: flex; gap: 10px; margin-top: 20px;">
                        <button class="action-btn secondary" onclick="hideModal()" style="flex: 1;">
                            Tutup
                        </button>
                    </div>
                </div>
            `;
            
            modalOverlay.classList.add('active');
        }
        
        function viewAllRants() {
            if (!currentUser) return;
            
            const d = getUserData(currentUser);
            if (!d.rants || d.rants.length === 0) {
                showToast('Belum ada rant untuk ditampilkan');
                return;
            }
            
            const modalOverlay = document.getElementById('modalOverlay');
            const modal = document.getElementById('modalContent');
            
            let modalContent = `
                <div class="modal-header">
                    <div class="modal-title">Semua Jejakmu</div>
                    <button class="modal-close" onclick="hideModal()">&times;</button>
                </div>
                <div style="max-height: 70vh; overflow-y: auto; padding: 10px 0;">
            `;
            
            const sortedRants = [...d.rants].sort((a, b) => b.date - a.date);
            
            if (sortedRants.length === 0) {
                modalContent += `<div style="text-align:center;padding:40px;color:rgba(255,255,255,0.5);">Belum ada rant</div>`;
            } else {
                sortedRants.forEach((r, i) => {
                    const date = new Date(r.date).toLocaleDateString('id-ID', { 
                        day: 'numeric', 
                        month: 'long', 
                        year: 'numeric',
                        hour: '2-digit', 
                        minute: '2-digit' 
                    });
                    
                    modalContent += `
                        <div style="margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid rgba(73,3,252,0.1);">
                            <div style="font-size: 11px; color: rgba(73,3,252,0.7); margin-bottom: 5px;">
                                ${date} ${r.hashtag ? '‚Ä¢ ' + r.hashtag : ''}
                            </div>
                            <div style="font-size: 14px; line-height: 1.5; color: white;">
                                ${r.content}
                            </div>
                        </div>
                    `;
                });
            }
            
            modalContent += `</div>`;
            modal.innerHTML = modalContent;
            modalOverlay.classList.add('active');
        }
        
        function hideModal() {
            document.getElementById('modalOverlay').classList.remove('active');
            artefakUploadState = {
                image: null,
                title: '',
                step: 0
            };
        }
        
        function reactToRant(emoji, button) {
            if (!currentUser) return;
            
            button.classList.toggle('active');
            showToast(`Kamu bereaksi ${emoji} pada rant ini`);
        }
        
        function exportData() {
            if (!currentUser) return;
            const d = getUserData(currentUser);
            const blob = new Blob([JSON.stringify({ username: currentUser, exportedAt: new Date().toISOString(), userData: d }, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `nope-${currentUser}-${Date.now()}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        
        function showHashtagsModal() {
            if (!currentUser) return;
            const d = getUserData(currentUser);
            
            const modalOverlay = document.getElementById('modalOverlay');
            const modal = document.getElementById('modalContent');
            
            let modalContent = `
                <div class="modal-header">
                    <div class="modal-title">Hashtag Terpilih</div>
                    <button class="modal-close" onclick="hideModal()">&times;</button>
                </div>
                <div style="padding: 15px 0;">
            `;
            
            if (!d.selectedHashtags) {
                modalContent += `<div style="text-align:center;padding:20px;color:rgba(255,255,255,0.5);">Belum memilih hashtag</div>`;
            } else {
                modalContent += `
                    <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 20px;">
                `;
                
                Object.entries(d.selectedHashtags).forEach(([zona, hashtag]) => {
                    if (hashtag) {
                        modalContent += `
                            <div style="background: rgba(73,3,252,0.1); padding: 8px 12px; border-radius: 6px; font-size: 12px; color: #4903fc;">
                                ${hashtag}
                            </div>
                        `;
                    }
                });
                
                modalContent += `</div>`;
            }
            
            modalContent += `
                <button class="action-btn secondary" onclick="hideModal()" style="width: 100%;">
                    Tutup
                </button>
            </div>`;
            
            modal.innerHTML = modalContent;
            modalOverlay.classList.add('active');
        }
        
        function logout() {
            if (confirm('Yakin ingin keluar?')) {
                localStorage.removeItem('nope_current_user');
                currentUser = null;
                showPage('login');
            }
        }
        
        // ===== INITIALIZE =====
        document.addEventListener('DOMContentLoaded', () => {
            initializeApp();
        });
    </script>
</body>
</html>
