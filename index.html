<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NOPE</title>
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#000000">
    <style>
        /* ===== RESET & BASE ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            background: #000;
            color: #fff;
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            min-height: 100vh;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
        }
        /* ===== PAGES ===== */
        .page {
            display: none;
            width: 100%;
            max-width: 500px;
            margin: 0 auto;
            padding: 15px;
            min-height: 100vh;
        }
        .page.active {
            display: block;
        }
        /* ===== LOGO NOPE ===== */
        .logo {
            font-size: 35px;
            font-weight: 900;
            color: #ff9999;
            margin: 0;
            line-height: 1;
            letter-spacing: -3px;
            position: absolute;
            top: 20px;
            left: 15px; /* Rata kiri dengan padding artefak */
        }
        /* ===== INPUT STYLE ===== */
        .nope-input {
            width: 100%;
            background: transparent;
            border: none;
            border-bottom: 1px solid rgba(73, 3, 252, 0.2);
            color: white;
            font-size: 22px;
            text-align: center;
            padding: 10px 0;
            outline: none;
            font-weight: 300;
            margin: 25px 0 15px 0;
        }
        .nope-input:focus {
            border-bottom-color: #4903fc;
        }
        /* ===== HINT TEXT ===== */
        .hint {
            text-align: center;
            color: rgba(73, 3, 252, 0.4);
            font-size: 12px;
            margin: 6px 0;
            line-height: 1.4;
        }
        .hint strong {
            color: rgba(73, 3, 252, 0.7);
        }
        /* ===== USER STATUS ===== */
        .user-status {
            text-align: center;
            margin: 10px 0;
            padding: 10px;
            font-size: 13px;
            line-height: 1.4;
            background: rgba(73, 3, 252, 0.05);
            color: rgba(73, 3, 252, 0.7);
            display: none;
            border-radius: 6px;
        }
        .user-status.show {
            display: block;
        }
        /* ===== ZONA SELECTION HEADER ===== */
        .zona-header {
            text-align: center;
            margin: 15px 0 25px 0;
        }
        .zona-title {
            font-size: 16px;
            font-weight: 600;
            color: #4903fc;
            margin-bottom: 5px;
        }
        .zona-subtitle {
            font-size: 12px;
            color: rgba(73, 3, 252, 0.5);
        }
        /* ===== ZONA CARD ===== */
        .zona-card {
            background: rgba(73, 3, 252, 0.03);
            border: 1px solid rgba(73, 3, 252, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
        }
        .zona-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(73, 3, 252, 0.1);
        }
        .zona-card-name {
            font-size: 16px;
            font-weight: 600;
            color: #4903fc;
        }
        .zona-card-desc {
            font-size: 11px;
            color: rgba(73, 3, 252, 0.5);
        }
        .zona-card-counter {
            font-size: 13px;
            color: #4903fc;
            font-weight: 600;
        }
        /* ===== HASHTAG SELECTION ===== */
        .hashtag-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .hashtag-item {
            padding: 10px;
            background: rgba(73, 3, 252, 0.05);
            border: 1px solid rgba(73, 3, 252, 0.08);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .hashtag-item:hover {
            background: rgba(73, 3, 252, 0.08);
        }
        .hashtag-item.selected {
            background: rgba(73, 3, 252, 0.15);
            border-color: #4903fc;
            box-shadow: 0 2px 6px rgba(73, 3, 252, 0.1);
        }
        .hashtag-name {
            font-size: 14px;
            font-weight: 500;
            color: rgba(73, 3, 252, 0.9);
            margin-bottom: 3px;
        }
        .hashtag-microcopy {
            font-size: 10px;
            color: rgba(73, 3, 252, 0.5);
            line-height: 1.3;
            font-style: italic;
        }
        /* ===== ACTION BUTTONS ===== */
        .action-btn {
            width: 100%;
            padding: 12px;
            margin: 8px 0;
            background: rgba(73, 3, 252, 0.15);
            border: 1px solid #4903fc;
            color: white;
            font-family: inherit;
            font-size: 16px;
            font-weight: 600;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
        }
        .action-btn:hover:not(:disabled) {
            background: rgba(73, 3, 252, 0.25);
            transform: translateY(-2px);
            box-shadow: 0 3px 8px rgba(73, 3, 252, 0.2);
        }
        .action-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }
        .action-btn.secondary {
            background: rgba(73, 3, 252, 0.05);
            border-color: rgba(73, 3, 252, 0.1);
        }
        .action-btn.secondary:hover {
            background: rgba(73, 3, 252, 0.1);
        }
        /* ===== JEJAK PAGE - NEW STYLES ===== */
        /* Artefak Preview - Full Width Image */
        .artefak-preview-container {
            margin: 15px 0;
            position: relative;
        }
        .artefak-preview {
            width: 100%;
            position: relative;
            background: rgba(73, 3, 252, 0.03);
            border: 1px solid rgba(73, 3, 252, 0.1);
            border-radius: 10px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s;
        }
        .artefak-preview:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(73, 3, 252, 0.15);
        }
        .artefak-preview-image {
            width: 100%;
            height: 0;
            padding-bottom: 80%;
            background: linear-gradient(135deg, rgba(73, 3, 252, 0.1), rgba(73, 3, 252, 0.1));
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        .artefak-preview-image img {
            position: absolute;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .artefak-upload-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.7);
            border: none;
            color: white;
            font-size: 18px;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
            transition: all 0.2s;
        }
        .artefak-upload-btn:hover {
            background: rgba(73, 3, 252, 0.7);
            transform: scale(1.1);
        }
        .artefak-title-input {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid rgba(73, 3, 252, 0.3);
            color: white;
            font-size: 11px;
            padding: 4px 8px;
            border-radius: 6px;
            max-width: 60%;
            z-index: 10;
            outline: none;
        }
        .artefak-title-input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }
        .artefak-placeholder {
            font-size: 48px;
            color: rgba(73, 3, 252, 0.2);
        }
        .artefak-preview-info {
            padding: 10px;
        }
        .artefak-preview-title {
            font-size: 14px;
            font-weight: 600;
            color: #fff;
            margin-bottom: 3px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .artefak-preview-date {
            font-size: 10px;
            color: rgba(73, 3, 252, 0.4);
        }
        /* Rant Box */
        .rant-box-container {
            margin: 20px 0;
        }
        .rant-box-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        .rant-box-title {
            font-size: 14px;
            font-weight: 600;
            color: #4903fc;
        }
        .rant-box-counter {
            font-size: 11px;
            color: rgba(73, 3, 252, 0.5);
            display: none;
        }
        .rant-box {
            width: 100%;
            min-height: 100px;
            background: rgba(73, 3, 252, 0.03);
            border: 1px solid rgba(73, 3, 252, 0.1);
            border-radius: 8px;
            padding: 12px;
            color: white;
            font-family: inherit;
            font-size: 13px;
            line-height: 1.4;
            resize: none;
            margin-bottom: 8px;
        }
        .rant-box:focus {
            outline: none;
            border-color: #4903fc;
            background: rgba(73, 3, 252, 0.05);
        }
        .rant-box::placeholder {
            color: rgba(73, 3, 252, 0.3);
        }
        .rant-box-footer {
            display: flex;
            justify-content: flex-end;
            align-items: center;
            margin-top: 10px;
        }
        .rant-box-footer .gaskeun-btn {
            background: transparent;
            border: none;
            color: #4903fc;
            font-family: inherit;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            padding: 8px 16px;
            border-radius: 6px;
            transition: all 0.2s;
            text-decoration: none;
        }
        .rant-box-footer .gaskeun-btn:hover {
            background: rgba(73, 3, 252, 0.1);
        }
        /* Recent Rants Section */
        .recent-rants {
            margin: 20px 0;
        }
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .section-title {
            font-size: 14px;
            font-weight: 600;
            color: #4903fc;
        }
        .section-view-all {
            font-size: 11px;
            color: rgba(73, 3, 252, 0.5);
            cursor: pointer;
            transition: color 0.2s;
        }
        .section-view-all:hover {
            color: #4903fc;
        }
        .recent-rants-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .recent-rant-item {
            background: rgba(73, 3, 252, 0.03);
            border: 1px solid rgba(73, 3, 252, 0.08);
            border-radius: 6px;
            padding: 10px;
            transition: all 0.2s;
        }
        .recent-rant-item:hover {
            background: rgba(73, 3, 252, 0.05);
            transform: translateY(-2px);
        }
        .recent-rant-date {
            font-size: 10px;
            color: rgba(73, 3, 252, 0.4);
            margin-bottom: 3px;
        }
        .recent-rant-content {
            font-size: 12px;
            color: rgba(73, 3, 252, 0.8);
            line-height: 1.4;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        /* ===== JALAN PAGE ===== */
        .jalan-header {
            text-align: center;
            margin: 15px 0 15px 0;
        }
        .jalan-title {
            font-size: 18px;
            font-weight: 600;
            color: #4903fc;
            margin-bottom: 8px;
        }
        .jalan-tab-nav {
            display: flex;
            justify-content: space-around;
            margin: 10px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            padding-bottom: 6px;
        }
        .jalan-tab-btn {
            background: none;
            border: none;
            color: rgba(255,255,255,0.6);
            font-size: 12px;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
        }
        .jalan-tab-btn.active {
            color: #4903fc;
            background: rgba(73, 3, 252, 0.1);
        }
        .jalan-tab-content {
            margin-top: 10px;
        }
        /* COMPACT RANT LIST */
        .recent-rants-list.compact {
            gap: 8px !important;
            margin-top: 10px;
        }
        .recent-rant-item.compact {
            padding: 8px !important;
            border-radius: 6px !important;
        }
        .recent-rant-date.compact {
            font-size: 9px;
            color: rgba(255, 255, 255, 0.4);
            margin-bottom: 3px;
        }
        .recent-rant-content.compact {
            font-size: 12px;
            line-height: 1.4;
            margin-bottom: 5px;
        }
        .rant-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 10px;
            color: rgba(255, 255, 255, 0.6);
        }
        .rant-emoji-bar {
            display: flex;
            gap: 5px;
        }
        .emoji-btn {
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.7);
            font-size: 13px;
            cursor: pointer;
            padding: 2px;
            border-radius: 4px;
        }
        .emoji-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        .emoji-btn.active {
            color: #4903fc;
        }
        .comment-link {
            color: rgba(255, 255, 255, 0.7);
            text-decoration: none;
            border-bottom: 1px solid rgba(255, 255, 255, 0.3);
            padding-bottom: 1px;
        }
        .comment-link:hover {
            color: #4903fc;
            border-bottom-color: #4903fc;
        }
        /* ===== DUNIA PAGE ===== */
        .dunia-header {
            text-align: center;
            margin: 15px 0 25px 0;
        }
        .dunia-title {
            font-size: 18px;
            font-weight: 600;
            color: #4903fc;
            margin-bottom: 8px;
        }
        .dunia-subtitle {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.6);
        }
        .profile-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }
        .profile-username {
            font-size: 20px;
            font-weight: 700;
            color: #4903fc;
            margin-bottom: 8px;
        }
        .profile-meta {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.5);
            margin: 5px 0;
        }
        /* ===== POST MODAL ===== */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 15px;
        }
        .modal-overlay.active {
            display: flex;
        }
        .modal {
            background: rgba(0, 0, 0, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            width: 100%;
            max-width: 450px;
            max-height: 90vh;
            overflow-y: auto;
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        .modal-title {
            font-size: 18px;
            font-weight: 600;
            color: #4903fc;
        }
        .modal-close {
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.5);
            font-size: 22px;
            cursor: pointer;
            padding: 0;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .modal-close:hover {
            color: white;
        }
        /* ===== BOTTOM NAV ===== */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.98);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-around;
            padding: 8px 0;
            z-index: 1000;
        }
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: rgba(255, 255, 255, 0.5);
            text-decoration: none;
            font-size: 10px;
            padding: 6px 8px;
            transition: all 0.2s;
            min-width: 60px;
        }
        .nav-item.active {
            color: #4903fc;
        }
        .nav-icon {
            font-size: 16px;
            margin-bottom: 2px;
        }
        .nav-label {
            font-weight: 500;
            letter-spacing: 0.5px;
        }
        /* ===== ANIMATION ===== */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        .fade-in {
            animation: fadeIn 0.3s ease;
        }
        .pulse {
            animation: pulse 1.5s infinite;
        }
        /* ===== CHARACTER COUNTER ===== */
        .char-counter {
            text-align: right;
            font-size: 11px;
            color: rgba(255, 255, 255, 0.4);
            margin-bottom: 10px;
            display: none;
        }
        /* ===== EMOJI BAR BELOW ARTEFAK ===== */
        .artefak-emoji-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 15px;
            margin-top: 6px;
            border-top: 1px solid rgba(73, 3, 252, 0.1);
        }
        .artefak-emoji-buttons {
            display: flex;
            gap: 15px;
        }
        .artefak-emoji-btn {
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.7);
            font-size: 20px;
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 6px;
            transition: all 0.2s;
            position: relative;
        }
        .artefak-emoji-btn:hover {
            color: #4903fc;
            transform: scale(1.1);
        }
        .artefak-emoji-btn.active {
            color: #4903fc;
        }
        .artefak-emoji-btn.has-new {
            animation: pulse 1.5s infinite;
            color: #ff9999;
        }
        .reaction-peek {
            position: relative;
            cursor: pointer;
        }
        .reaction-peek-popup {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.95);
            border: 1px solid rgba(73, 3, 252, 0.3);
            border-radius: 8px;
            padding: 10px;
            min-width: 150px;
            z-index: 100;
            display: none;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
        }
        .reaction-peek-popup.show {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        .reaction-peek-title {
            font-size: 10px;
            color: rgba(73, 3, 252, 0.7);
            margin-bottom: 6px;
            text-align: center;
            font-weight: 600;
        }
        .reaction-user-list {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        .reaction-user-item {
            font-size: 11px;
            color: rgba(255, 255, 255, 0.8);
            padding: 3px 6px;
            border-radius: 4px;
            background: rgba(73, 3, 252, 0.1);
        }
        /* ===== ARTEFAK GRID 3 KOLOM ===== */
        .artefaks-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 20px 0;
        }
        .artefak-grid-item {
            background: rgba(73, 3, 252, 0.03);
            border: 1px solid rgba(73, 3, 252, 0.08);
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s;
            aspect-ratio: 1;
            position: relative;
        }
        .artefak-grid-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(73, 3, 252, 0.15);
        }
        .artefak-grid-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }
        .artefak-grid-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.7);
            padding: 8px;
            transform: translateY(100%);
            transition: transform 0.3s;
        }
        .artefak-grid-item:hover .artefak-grid-overlay {
            transform: translateY(0);
        }
        .artefak-grid-title {
            font-size: 11px;
            font-weight: 600;
            color: white;
            margin-bottom: 2px;
        }
        .artefak-grid-date {
            font-size: 9px;
            color: rgba(255, 255, 255, 0.6);
        }
        /* ===== FILE UPLOAD ===== */
        .file-input-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
        }
        .file-input-wrapper input[type=file] {
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <!-- POST MODAL -->
    <div class="modal-overlay" id="modalOverlay">
        <div class="modal">
            <!-- Modal content will be injected here -->
        </div>
    </div>
    <!-- BOTTOM NAVIGATION -->
    <div class="bottom-nav" id="bottomNav" style="display: none;">
        <a href="#" class="nav-item active" onclick="showTab('jejak')">
            <div class="nav-icon">üìù</div>
            <div class="nav-label">Jejak</div>
        </a>
        <a href="#" class="nav-item" onclick="showTab('jalan')">
            <div class="nav-icon">üö∂</div>
            <div class="nav-label">Jalan</div>
        </a>
        <a href="#" class="nav-item" onclick="showTab('dunia')">
            <div class="nav-icon">üåç</div>
            <div class="nav-label">Dunia</div>
        </a>
    </div>
    <!-- LOGIN PAGE -->
    <div id="login" class="page active">
        <div class="logo">NOPE</div>
        <input type="text" 
               class="nope-input" 
               id="usernameInput"
               placeholder="nama_kamu"
               autocomplete="off"
               autocapitalize="none"
               spellcheck="false">
        <div class="user-status" id="userStatus"></div>
        <div class="hint">
            gunakan huruf, angka, underscore ‚Ä¢ minimal 3 karakter
        </div>
        <div class="hint">
            tekan <strong>enter</strong> untuk masuk
        </div>
        <div class="hint mt-20">
            3#, jurnal, artefak tersimpan selamanya
        </div>
    </div>
    <!-- ONBOARDING PAGE -->
    <div id="onboarding" class="page">
        <div class="logo">NOPE</div>
        <div class="zona-header">
            <div class="zona-title">Pilih 1# dari masing-masing 3 zona</div>
        </div>
        <!-- Zona 1: PopCulture -->
        <div class="zona-card">
            <div class="zona-card-header">
                <div>
                    <div class="zona-card-name">PopCulture</div>
                    <div class="zona-card-desc">Film, musik, meme, tren viral</div>
                </div>
                <div class="zona-card-counter" id="popcultureCounter">0/1</div>
            </div>
            <div class="hashtag-list" id="popcultureList"></div>
        </div>
        <!-- Zona 2: PersonalPain -->
        <div class="zona-card">
            <div class="zona-card-header">
                <div>
                    <div class="zona-card-name">PersonalPain</div>
                    <div class="zona-card-desc">Kecemasan, trauma, healing, self-care</div>
                </div>
                <div class="zona-card-counter" id="personalpainCounter">0/1</div>
            </div>
            <div class="hashtag-list" id="personalpainList"></div>
        </div>
        <!-- Zona 3: SocialSickness -->
        <div class="zona-card">
            <div class="zona-card-header">
                <div>
                    <div class="zona-card-name">SocialSickness</div>
                    <div class="zona-card-desc">Toxic relationship, FOMO, loneliness</div>
                </div>
                <div class="zona-card-counter" id="socialsicknessCounter">0/1</div>
            </div>
            <div class="hashtag-list" id="socialsicknessList"></div>
        </div>
        <!-- Action Button -->
        <button class="action-btn" id="saveBtn" onclick="saveSelections()" disabled>
            Lanjutkan
        </button>
    </div>
    <!-- JEJAK PAGE -->
    <div id="jejak" class="page" style="padding-top: 80px;">
        <div class="logo">NOPE</div>
        <!-- Artefak Preview -->
        <div class="artefak-preview-container" id="artefakPreviewContainer"></div>
        <!-- Rant Box -->
        <div class="rant-box-container">
            <div class="rant-box-header">
                <div class="rant-box-counter" id="rantCounter">0/300</div>
            </div>
            <textarea 
                class="rant-box" 
                id="rantBox" 
                placeholder="Perasaanmu dalam 300 huruf" 
                maxlength="300" 
                rows="5"
            ></textarea>
            <div class="rant-box-footer">
                <button class="gaskeun-btn" onclick="postRantFromBox()">
                    Gaskeun!
                </button>
            </div>
        </div>
        <!-- Recent Rants -->
        <div class="recent-rants">
            <div class="section-header">
                <div class="section-title">Jejakmu</div>
                <div class="section-view-all" onclick="viewAllRants()">Lihat semua</div>
            </div>
            <div class="recent-rants-list" id="recentRantsList">
                <!-- Recent rants will be populated by JavaScript -->
            </div>
        </div>
        <!-- Artefak Grid 3x2 -->
        <div class="artefaks-grid" id="artefaksGrid">
            <!-- Akan diisi oleh JavaScript -->
        </div>
    </div>
    <!-- JALAN PAGE -->
    <div id="jalan" class="page">
        <div class="logo">NOPE</div>
        <div class="jalan-header">
            <div class="jalan-title">Jalan mu</div>
        </div>
        <!-- Tab Navigation -->
        <div class="jalan-tab-nav">
            <button class="jalan-tab-btn active" onclick="showJalanTab('frekuensi')">Frekuensi</button>
            <button class="jalan-tab-btn" onclick="showJalanTab('gelombang')">Gelombang</button>
            <button class="jalan-tab-btn" onclick="showJalanTab('movement')">Movement</button>
        </div>
        <!-- Frekuensi Tab -->
        <div id="jalan-frekuensi" class="jalan-tab-content">
            <div class="section-header">
                <div class="section-title">3# pilihan mu</div>
            </div>
            <div class="recent-rants-list compact" id="frekuensiList"></div>
        </div>
        <!-- Gelombang Tab -->
        <div id="jalan-gelombang" class="jalan-tab-content" style="display:none;">
            <div class="section-header">
                <div class="section-title">Gelombang Global</div>
            </div>
            <div class="recent-rants-list compact" id="gelombangList"></div>
        </div>
        <!-- Movement Tab -->
        <div id="jalan-movement" class="jalan-tab-content" style="display:none;">
            <div class="section-header">
                <div class="section-title">Movement</div>
            </div>
            <div class="recent-rants-list compact" id="movementList"></div>
        </div>
        <!-- Hashtag terpilih -->
        <div class="zona-card" style="margin-top: 15px;">
            <div class="zona-card-header" style="padding-bottom:6px;margin-bottom:8px;">
                <div>
                    <div class="zona-card-name" style="font-size:14px;">Frekuensi mu</div>
                </div>
            </div>
            <div id="selectedHashtagsList" style="display:flex;gap:6px;flex-wrap:wrap;"></div>
        </div>
    </div>
    <!-- DUNIA PAGE -->
    <div id="dunia" class="page">
        <div class="logo">NOPE</div>
        <div class="dunia-header">
            <div class="dunia-title">Dunia mu</div>
            <div class="dunia-subtitle">
                Profil dan pengaturan
            </div>
        </div>
        <div class="profile-card">
            <div class="profile-username" id="profileUsername">@username</div>
            <div class="profile-meta" id="profileJoinDate">Bergabung: -</div>
            <div class="profile-meta" id="profileActivity">Aktivitas: 0 posting</div>
        </div>
        <div class="action-btn" onclick="showArtefakModal()" style="margin-top: 8px;">
            + Tambah Artefak
        </div>
        <div class="action-btn secondary" onclick="exportData()" style="margin-top: 8px;">
            üì§ Export Data
        </div>
        <div class="action-btn secondary" onclick="showHashtagsModal()" style="margin-top: 8px;">
            üëÅÔ∏è Lihat # terpilih
        </div>
        <div class="action-btn secondary" onclick="logout()" style="background: rgba(255,50,50,0.1); border-color: rgba(255,50,50,0.3); margin-top: 15px;">
            üö™ Keluar
        </div>
    </div>
    
    <!-- Hidden file input for artefak upload -->
    <input type="file" id="artefakFileInput" accept="image/*" style="display: none;">
    
    <script>
        // ===== STATE =====
        let currentUser = null;
        let currentTab = 'jejak';
        let currentArtefakReactions = {
            nangis: {
                count: 0,
                users: [],
                hasNew: false
            },
            api: {
                count: 0,
                users: [],
                hasNew: false
            },
            badut: {
                count: 0,
                users: [],
                hasNew: false
            },
            unggah: {
                count: 0,
                users: [],
                hasNew: false
            }
        };
        
        // ===== SELECTED HASHTAGS =====
        let selectedHashtags = {
            popculture: null,
            personalpain: null,
            socialsickness: null
        };
        
        // ===== DATA STRUCTURE =====
        const zonaData = {
            popculture: {
                name: "PopCulture",
                description: "Film, musik, meme, tren viral",
                hashtags: [
                    { name: "#FilmEndingGaje", microcopy: "capek nunggu akhir yang masuk akal. hidup aja nggak pernah adil." },
                    { name: "#InfluencerNgehek", microcopy: "liat konten 'hidup sempurna', pas DM minta endorse malah auto read." },
                    { name: "#BeliTiketJualGinjal", microcopy: "harga tiket konser = 3 bulan gaji magang. tapi hati bilang: worth it." },
                    { name: "#HealingPayLater", microcopy: "self-care pakai cicilan. besok stres, hari ini bahagia dulu." }
                ]
            },
            personalpain: {
                name: "PersonalPain",
                description: "Kecemasan, trauma, healing, self-care",
                hashtags: [
                    { name: "#SayNOPE", microcopy: "bukan sombong. cuma lagi butuh ruang untuk pulih." },
                    { name: "#DiGhostingGebetan", microcopy: "ditinggal tanpa kabar, tapi masih ngecek story-nya tiap malam." },
                    { name: "#CapekPuraPura", microcopy: "senyum di WA, nangis di kamar mandi." },
                    { name: "#DiamDiamNangis", microcopy: "nangis tanpa suara, biar nggak jadi beban buat orang." }
                ]
            },
            socialsickness: {
                name: "SocialSickness",
                description: "Toxic relationship, FOMO, loneliness",
                hashtags: [
                    { name: "#MagangDibayarSerifikat", microcopy: "kerja 8 jam, upahnya cuma kertas yang nggak bisa bayar kos." },
                    { name: "#KeluarWAGroup", microcopy: "tinggalkan grup yang bikin anxiety, bukan kehilangan teman." },
                    { name: "#TemenLambeTurah", microcopy: "curhat dikira rahasia, eh besok jadi bahan gosip." },
                    { name: "#GajianSejamAbis", microcopy: "gajian pagi, siang udah nol. tapi tetap dipanggil 'pelit'." }
                ]
            }
        };
        
        // Dummy foto artefak untuk Gen Z
        const dummyArtefakPhotos = [
            {
                url: "https://images.unsplash.com/photo-1563089145-599997674d42?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
                title: "Late Night Vibes",
                date: "15 Mar 2025"
            },
            {
                url: "https://images.unsplash.com/photo-1542744095-fcf48d80b0fd?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
                title: "Studio Session",
                date: "12 Mar 2025"
            },
            {
                url: "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
                title: "Gym Progress",
                date: "10 Mar 2025"
            },
            {
                url: "https://images.unsplash.com/photo-1528702748617-c64d49f918af?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
                title: "Cafe Moments",
                date: "08 Mar 2025"
            },
            {
                url: "https://images.unsplash.com/photo-1558618666-fcd25c85cd64?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
                title: "Concert Memory",
                date: "05 Mar 2025"
            },
            {
                url: "https://images.unsplash.com/photo-1593115057322-e94b77572f20?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
                title: "Skyline View",
                date: "01 Mar 2025"
            }
        ];
        
        // ===== STORAGE HELPERS =====
        function getUsers() {
            const usersJson = localStorage.getItem('nope_users');
            return usersJson ? JSON.parse(usersJson) : {};
        }
        
        function saveUsers(users) {
            localStorage.setItem('nope_users', JSON.stringify(users));
        }
        
        function getUserData(username) {
            const users = getUsers();
            return users[username] || null;
        }
        
        function saveUserData(username, data) {
            const users = getUsers();
            users[username] = data;
            saveUsers(users);
        }
        
        function getArtefakReactions() {
            const reactionsJson = localStorage.getItem('nope_artefak_reactions');
            return reactionsJson ? JSON.parse(reactionsJson) : {};
        }
        
        function saveArtefakReactions(reactions) {
            localStorage.setItem('nope_artefak_reactions', JSON.stringify(reactions));
        }
        
        // ===== DUMMY DATA INITIALIZATION =====
        function initializeDummyData() {
            const users = getUsers();
            if (Object.keys(users).length > 0) return;
            
            const now = Date.now();
            const dummyUsers = [
                {
                    username: "diamdiamaja",
                    hashtags: ["#SayNOPE", "#CapekPuraPura", "#DiamDiamNangis"],
                    rant: "bilang gue baik-baik aja padahal hati lagi kacau. capek jadi tempat curhat tapi gak pernah boleh curhat.",
                    artefak: {
                        title: "kopi dingin",
                        content: "minum sendirian jam 3 pagi. gajian belum turun, besok bayar kos."
                    }
                },
                {
                    username: "ghosted_aja",
                    hashtags: ["#DiGhostingGebetan", "#CapekPuraPura", "#FilmEndingGaje"],
                    rant: "udah 3 minggu dia ngilang. gue cek story-nya tiap malem. padahal cuma nanya 'udah makan?'",
                    artefak: {
                        title: "notifikasi kosong",
                        content: "kotak chat belum terkirim. niat nanya kabar aja susah."
                    }
                },
                {
                    username: "maganggratis",
                    hashtags: ["#MagangDibayarSerifikat", "#GajianSejamAbis", "#HealingPayLater"],
                    rant: "kerja 9 jam, pulang bawa serifikat. ibu bilang 'itu investasi'. investasi buat apa, bu? buat bayar listrik?",
                    artefak: {
                        title: "serifikat gulung",
                        content: "dikasih frame, tapi gak ada duit buat beli bingkai."
                    }
                },
                {
                    username: "temenpalsu",
                    hashtags: ["#TemenLambeTurah", "#KeluarWAGroup", "#InfluencerNgehek"],
                    rant: "curhat soal gebetan, eh besok jadi bahan gosip di grup. sekarang gue milih sendiri aja.",
                    artefak: {
                        title: "chat terhapus",
                        content: "percaya itu mahal. gue udah bangkrut."
                    }
                },
                {
                    username: "konserginjal",
                    hashtags: ["#BeliTiketJualGinjal", "#HealingPayLater", "#FilmEndingGaje"],
                    rant: "tiket konser habis 1.2 juta. gaji magang 800rb. tapi malam itu gue nangis bahagia. worth it.",
                    artefak: {
                        title: "tiket sobek",
                        content: "masih genggam erat pas pulang naik angkot."
                    }
                }
            ];
            
            // Buat dummy user
            dummyUsers.forEach((user, i) => {
                users[user.username] = {
                    username: user.username,
                    created: now - (15 - i) * 24 * 60 * 60 * 1000,
                    lastLogin: now - (15 - i) * 24 * 60 * 60 * 1000,
                    onboarded: true,
                    selectedHashtags: {
                        popculture: user.hashtags.find(h => zonaData.popculture.hashtags.some(t => t.name === h)) || null,
                        personalpain: user.hashtags.find(h => zonaData.personalpain.hashtags.some(t => t.name === h)) || null,
                        socialsickness: user.hashtags.find(h => zonaData.socialsickness.hashtags.some(t => t.name === h)) || null,
                        movement: user.hashtags.find(h => ["#PendidikanUntukSemua","#JanganExploitBuruh","#FUNDINGSolidaritasDiam","#PetisiTerbuka"].includes(h)) || null
                    },
                    rants: [{
                        content: user.rant,
                        hashtag: user.hashtags[Math.floor(Math.random()*user.hashtags.length)],
                        date: now - (15 - i) * 24 * 60 * 60 * 1000
                    }],
                    artefacts: [{
                        title: user.artefak.title,
                        content: user.artefak.content,
                        date: now - (15 - i) * 24 * 60 * 60 * 1000 + 10000
                    }]
                };
            });
            saveUsers(users);
            
            // Inisialisasi dummy reactions
            const reactions = getArtefakReactions();
            if (!reactions[currentUser]) {
                reactions[currentUser] = {
                    nangis: { count: 3, users: ["diamdiamaja", "ghosted_aja", "maganggratis"], hasNew: true },
                    api: { count: 2, users: ["temenpalsu", "konserginjal"], hasNew: true },
                    badut: { count: 1, users: ["diamdiamaja"], hasNew: false },
                    unggah: { count: 0, users: [], hasNew: false }
                };
                saveArtefakReactions(reactions);
            }
        }
        
        // ===== FIXED INIT APP - SELALU MULAI DARI LOGIN =====
        function initializeApp() {
            initializeDummyData();
            
            // SELALU mulai dari halaman login
            // Hapus user yang sedang login untuk memastikan login ulang
            localStorage.removeItem('nope_current_user');
            currentUser = null;
            
            // Tampilkan halaman login
            showPage('login');
            
            // Reset semua halaman lain agar tidak aktif
            document.querySelectorAll('.page:not(#login)').forEach(p => p.classList.remove('active'));
        }
        
        // ===== SHOW PAGE & TAB =====
        function showPage(pageId) {
            // Cek jika user belum login tapi mencoba akses halaman lain
            if (pageId !== 'login' && pageId !== 'onboarding' && !currentUser) {
                showPage('login');
                return;
            }
            
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active','fade-in'));
            const p = document.getElementById(pageId);
            if (p) {
                p.classList.add('active','fade-in');
                const nav = document.getElementById('bottomNav');
                if (['jejak','jalan','dunia'].includes(pageId)) {
                    nav.style.display = 'flex';
                    updateNavActive(pageId);
                } else {
                    nav.style.display = 'none';
                }
                switch(pageId) {
                    case 'login': initLoginPage(); break;
                    case 'onboarding': initOnboardingPage(); break;
                    case 'jejak': initJejakPage(); break;
                    case 'jalan': initJalanPage(); break;
                    case 'dunia': initDuniaPage(); break;
                }
            }
        }
        
        function showTab(tabId) { 
            if (!currentUser) {
                showPage('login');
                return;
            }
            showPage(tabId); 
        }
        
        function updateNavActive(activeTab) {
            document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
            const btn = document.querySelector(`.nav-item[onclick*="${activeTab}"]`);
            if (btn) btn.classList.add('active');
        }
        
        // ===== LOGIN =====
        function initLoginPage() {
            const input = document.getElementById('usernameInput');
            const status = document.getElementById('userStatus');
            input.value = '';
            input.focus();
            status.style.display = 'none';
            
            // Pastikan event listener tidak duplikat
            const newInput = input.cloneNode(true);
            input.parentNode.replaceChild(newInput, input);
            const el = document.getElementById('usernameInput');
            
            el.addEventListener('keydown', e => { 
                if (e.key === 'Enter') processLogin(); 
            });
            
            el.addEventListener('input', function() {
                let u = this.value.trim().toLowerCase();
                if (u.length < 3) { 
                    status.style.display = 'none'; 
                    return; 
                }
                let f = u.replace(/\s+/g, '_').replace(/[^a-z0-9_]/g, '');
                if (u !== f) this.value = f;
                const d = getUserData(f);
                status.style.display = 'block';
                if (d) {
                    status.textContent = d.onboarded ? 
                        `@${f} sudah ada ‚Ä¢ tekan enter untuk login` : 
                        `@${f} belum onboarding ‚Ä¢ tekan enter untuk lanjut`;
                } else {
                    status.textContent = `@${f} akan dibuat baru`;
                }
            });
        }
        
        function processLogin() {
            let u = document.getElementById('usernameInput').value.trim().toLowerCase();
            if (u.length < 3) { 
                alert('Username minimal 3 karakter!'); 
                return; 
            }
            u = u.replace(/\s+/g, '_').replace(/[^a-z0-9_]/g, '');
            if (u.length < 3) { 
                alert('Username hanya boleh huruf, angka, underscore!'); 
                return; 
            }
            currentUser = u;
            localStorage.setItem('nope_current_user', u);
            let d = getUserData(u);
            if (!d) {
                d = { 
                    username: u, 
                    created: Date.now(), 
                    lastLogin: Date.now(), 
                    selectedHashtags: null, 
                    onboarded: false, 
                    rants: [], 
                    artefacts: [] 
                };
                saveUserData(u, d);
                showPage('onboarding');
            } else {
                d.lastLogin = Date.now();
                saveUserData(u, d);
                showPage(d.onboarded ? 'jejak' : 'onboarding');
            }
        }
        
        // ===== ONBOARDING =====
        function initOnboardingPage() {
            if (!currentUser) return showPage('login');
            const d = getUserData(currentUser);
            if (d && d.onboarded) return showPage('jejak');
            
            selectedHashtags = d && d.selectedHashtags ? { ...d.selectedHashtags } : { 
                popculture: null, 
                personalpain: null, 
                socialsickness: null 
            };
            
            ['popculture','personalpain','socialsickness'].forEach(z => renderHashtags(z));
            updateCounters();
        }
        
        function renderHashtags(z) {
            const c = document.getElementById(z + 'List');
            const zona = zonaData[z];
            c.innerHTML = '';
            zona.hashtags.forEach(h => {
                const sel = selectedHashtags[z] === h.name;
                const div = document.createElement('div');
                div.className = `hashtag-item ${sel ? 'selected' : ''}`;
                div.onclick = () => selectHashtag(z, h.name);
                div.innerHTML = `<div class="hashtag-name">${h.name}</div><div class="hashtag-microcopy">${h.microcopy}</div>`;
                c.appendChild(div);
            });
        }
        
        function selectHashtag(z, h) {
            selectedHashtags[z] = selectedHashtags[z] === h ? null : h;
            renderHashtags(z);
            updateCounters();
        }
        
        function updateCounters() {
            document.getElementById('popcultureCounter').textContent = `${selectedHashtags.popculture ? '1' : '0'}/1`;
            document.getElementById('personalpainCounter').textContent = `${selectedHashtags.personalpain ? '1' : '0'}/1`;
            document.getElementById('socialsicknessCounter').textContent = `${selectedHashtags.socialsickness ? '1' : '0'}/1`;
            const total = Object.values(selectedHashtags).filter(h => h).length;
            document.getElementById('saveBtn').disabled = total !== 3;
        }
        
        function saveSelections() {
            if (!currentUser) return;
            const d = getUserData(currentUser);
            d.selectedHashtags = selectedHashtags;
            d.onboarded = true;
            d.lastLogin = Date.now();
            saveUserData(currentUser, d);
            document.getElementById('saveBtn').textContent = 'Menyimpan...';
            document.getElementById('saveBtn').disabled = true;
            setTimeout(() => showPage('jejak'), 600);
        }
        
        // ===== JEJAK =====
        function initJejakPage() {
            if (!currentUser) return showPage('login');
            const d = getUserData(currentUser);
            setupRantBox();
            renderArtefakPreview();
            renderRecentRants();
            renderArtefakGrid();
            loadArtefakReactions();
        }
        
        function setupRantBox() {
            const box = document.getElementById('rantBox');
            box.value = '';
        }
        
        function renderArtefakPreview() {
            const c = document.getElementById('artefakPreviewContainer');
            const d = getUserData(currentUser);
            
            let artefakHtml = '';
            
            if (!d.artefacts || d.artefacts.length === 0) {
                artefakHtml = `
                    <div class="artefak-preview">
                        <div class="artefak-preview-image">
                            <div class="artefak-placeholder">üñºÔ∏è</div>
                            <!-- Upload Button -->
                            <button class="artefak-upload-btn" onclick="document.getElementById('artefakFileInput').click()" title="Upload Artefak">
                                üì§
                            </button>
                            <!-- Title Input -->
                            <input type="text" 
                                   class="artefak-title-input" 
                                   id="artefakTitleInput"
                                   placeholder="maks 4 kata"
                                   maxlength="30"
                                   oninput="validateArtefakTitle()">
                        </div>
                        <div class="artefak-preview-info">
                            <div class="artefak-preview-title">üìÅ Belum ada artefak</div>
                        </div>
                        ${renderArtefakEmojiBar()}
                    </div>`;
            } else {
                const latest = d.artefacts[d.artefacts.length - 1];
                const date = new Date(latest.date).toLocaleDateString('id-ID', { day: 'numeric', month: 'long', year: 'numeric' });
                
                artefakHtml = `
                    <div class="artefak-preview">
                        <div class="artefak-preview-image">
                            ${latest.imageUrl ? 
                                `<img src="${latest.imageUrl}" alt="${latest.title}">` : 
                                `<div class="artefak-placeholder">üìÅ</div>`
                            }
                            <!-- Upload Button -->
                            <button class="artefak-upload-btn" onclick="document.getElementById('artefakFileInput').click()" title="Upload Artefak">
                                üì§
                            </button>
                            <!-- Title Display -->
                            <div class="artefak-title-input" style="background: rgba(0,0,0,0.7); border: none; pointer-events: none;">
                                ${latest.title}
                            </div>
                        </div>
                        <div class="artefak-preview-info">
                            <div class="artefak-preview-title">üìÅ ${latest.title}</div>
                            <div class="artefak-preview-date">Ditambahkan: ${date}</div>
                        </div>
                        ${renderArtefakEmojiBar()}
                    </div>`;
            }
            
            c.innerHTML = artefakHtml;
            
            // Setup file input listener
            const fileInput = document.getElementById('artefakFileInput');
            fileInput.onchange = handleArtefakUpload;
        }
        
        function renderArtefakEmojiBar() {
            const reactions = getArtefakReactions()[currentUser] || currentArtefakReactions;
            
            return `
                <div class="artefak-emoji-bar">
                    <div class="artefak-emoji-buttons">
                        <!-- Nangis -->
                        <div class="reaction-peek">
                            <button class="artefak-emoji-btn ${reactions.nangis.hasNew ? 'has-new' : ''}" 
                                    onclick="reactToArtefak('nangis')" 
                                    title="Nangis">
                                üò≠
                            </button>
                            <div class="reaction-peek-popup" id="nangisPeekPopup">
                                <div class="reaction-peek-title">üò≠ Nangis</div>
                                <div class="reaction-user-list" id="nangisUserList">
                                    <!-- Users will be populated by JavaScript -->
                                </div>
                            </div>
                        </div>
                        
                        <!-- Api -->
                        <div class="reaction-peek">
                            <button class="artefak-emoji-btn ${reactions.api.hasNew ? 'has-new' : ''}" 
                                    onclick="reactToArtefak('api')" 
                                    title="Api">
                                üî•
                            </button>
                            <div class="reaction-peek-popup" id="apiPeekPopup">
                                <div class="reaction-peek-title">üî• Api</div>
                                <div class="reaction-user-list" id="apiUserList">
                                    <!-- Users will be populated by JavaScript -->
                                </div>
                            </div>
                        </div>
                        
                        <!-- Badut -->
                        <div class="reaction-peek">
                            <button class="artefak-emoji-btn ${reactions.badut.hasNew ? 'has-new' : ''}" 
                                    onclick="reactToArtefak('badut')" 
                                    title="Badut">
                                ü§°
                            </button>
                            <div class="reaction-peek-popup" id="badutPeekPopup">
                                <div class="reaction-peek-title">ü§° Badut</div>
                                <div class="reaction-user-list" id="badutUserList">
                                    <!-- Users will be populated by JavaScript -->
                                </div>
                            </div>
                        </div>
                        
                        <!-- Unggah -->
                        <div class="reaction-peek">
                            <button class="artefak-emoji-btn ${reactions.unggah.hasNew ? 'has-new' : ''}" 
                                    onclick="reactToArtefak('unggah')" 
                                    title="Unggah">
                                üì§
                            </button>
                            <div class="reaction-peek-popup" id="unggahPeekPopup">
                                <div class="reaction-peek-title">üì§ Unggah</div>
                                <div class="reaction-user-list" id="unggahUserList">
                                    <!-- Users will be populated by JavaScript -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>`;
        }
        
        function loadArtefakReactions() {
            const reactions = getArtefakReactions();
            if (reactions[currentUser]) {
                currentArtefakReactions = reactions[currentUser];
            }
            
            // Populate peek popups
            updateReactionPeekPopups();
        }
        
        function updateReactionPeekPopups() {
            // Update nangis peek
            const nangisUsers = currentArtefakReactions.nangis.users.slice(0, 5);
            const nangisList = document.getElementById('nangisUserList');
            if (nangisList) {
                nangisList.innerHTML = nangisUsers.map(user => 
                    `<div class="reaction-user-item">@${user}</div>`
                ).join('');
                if (nangisUsers.length === 0) {
                    nangisList.innerHTML = '<div class="reaction-user-item" style="color: rgba(255,255,255,0.5); font-style: italic;">Belum ada reaksi</div>';
                }
            }
            
            // Update api peek
            const apiUsers = currentArtefakReactions.api.users.slice(0, 5);
            const apiList = document.getElementById('apiUserList');
            if (apiList) {
                apiList.innerHTML = apiUsers.map(user => 
                    `<div class="reaction-user-item">@${user}</div>`
                ).join('');
                if (apiUsers.length === 0) {
                    apiList.innerHTML = '<div class="reaction-user-item" style="color: rgba(255,255,255,0.5); font-style: italic;">Belum ada reaksi</div>';
                }
            }
            
            // Update badut peek
            const badutUsers = currentArtefakReactions.badut.users.slice(0, 5);
            const badutList = document.getElementById('badutUserList');
            if (badutList) {
                badutList.innerHTML = badutUsers.map(user => 
                    `<div class="reaction-user-item">@${user}</div>`
                ).join('');
                if (badutUsers.length === 0) {
                    badutList.innerHTML = '<div class="reaction-user-item" style="color: rgba(255,255,255,0.5); font-style: italic;">Belum ada reaksi</div>';
                }
            }
            
            // Update unggah peek
            const unggahUsers = currentArtefakReactions.unggah.users.slice(0, 5);
            const unggahList = document.getElementById('unggahUserList');
            if (unggahList) {
                unggahList.innerHTML = unggahUsers.map(user => 
                    `<div class="reaction-user-item">@${user}</div>`
                ).join('');
                if (unggahUsers.length === 0) {
                    unggahList.innerHTML = '<div class="reaction-user-item" style="color: rgba(255,255,255,0.5); font-style: italic;">Belum ada reaksi</div>';
                }
            }
            
            // Setup peek popup toggle
            setupPeekPopups();
        }
        
        function setupPeekPopups() {
            // Add event listeners to all reaction buttons
            document.querySelectorAll('.reaction-peek').forEach(peek => {
                const btn = peek.querySelector('.artefak-emoji-btn');
                const popup = peek.querySelector('.reaction-peek-popup');
                
                if (btn && popup) {
                    btn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const isShowing = popup.classList.contains('show');
                        
                        // Hide all other popups
                        document.querySelectorAll('.reaction-peek-popup').forEach(p => {
                            p.classList.remove('show');
                        });
                        
                        // Toggle this popup
                        if (!isShowing) {
                            popup.classList.add('show');
                        }
                    });
                    
                    // Close when clicking outside
                    document.addEventListener('click', (e) => {
                        if (!peek.contains(e.target)) {
                            popup.classList.remove('show');
                        }
                    });
                }
            });
        }
        
        function validateArtefakTitle() {
            const input = document.getElementById('artefakTitleInput');
            const value = input.value.trim();
            
            // Count words
            const wordCount = value.split(/\s+/).filter(word => word.length > 0).length;
            
            if (wordCount > 4) {
                input.style.borderColor = '#ff3333';
                showToast('Maksimum 4 kata untuk judul artefak');
                // Remove extra words
                const words = value.split(/\s+/).slice(0, 4).join(' ');
                input.value = words;
            } else {
                input.style.borderColor = 'rgba(73, 3, 252, 0.3)';
            }
        }
        
        function handleArtefakUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            // Check if file is an image
            if (!file.type.match('image.*')) {
                alert('Hanya file gambar yang diperbolehkan!');
                return;
            }
            
            // Check file size (max 5MB)
            if (file.size > 5 * 1024 * 1024) {
                alert('Ukuran file maksimal 5MB!');
                return;
            }
            
            // Get title from input
            const titleInput = document.getElementById('artefakTitleInput');
            let title = titleInput ? titleInput.value.trim() : '';
            
            // Validate title
            if (!title) {
                title = 'Artefak Baru';
            }
            
            // Count words
            const wordCount = title.split(/\s+/).filter(word => word.length > 0).length;
            if (wordCount > 4) {
                alert('Judul artefak maksimal 4 kata!');
                return;
            }
            
            // Create file reader
            const reader = new FileReader();
            
            reader.onload = function(e) {
                const imageUrl = e.target.result;
                
                // Save artefak to user data
                const d = getUserData(currentUser);
                if (!d.artefacts) d.artefacts = [];
                
                d.artefacts.push({
                    title: title,
                    imageUrl: imageUrl,
                    date: Date.now(),
                    content: `Artefak diupload: ${new Date().toLocaleDateString('id-ID')}`
                });
                
                d.lastLogin = Date.now();
                saveUserData(currentUser, d);
                
                // Reset file input
                document.getElementById('artefakFileInput').value = '';
                
                // Re-render artefak preview
                renderArtefakPreview();
                showToast('Artefak berhasil diupload!');
            };
            
            reader.onerror = function() {
                alert('Gagal membaca file!');
            };
            
            reader.readAsDataURL(file);
        }
        
        function reactToArtefak(reactionType) {
            if (!currentUser) return;
            
            const reactions = getArtefakReactions();
            if (!reactions[currentUser]) {
                reactions[currentUser] = JSON.parse(JSON.stringify(currentArtefakReactions));
            }
            
            const userReactions = reactions[currentUser];
            
            // Check if user already reacted
            if (!userReactions[reactionType].users.includes(currentUser)) {
                userReactions[reactionType].count++;
                userReactions[reactionType].users.push(currentUser);
                userReactions[reactionType].hasNew = true;
                
                // For demo, add some dummy users
                if (userReactions[reactionType].users.length === 1) {
                    const dummyUsers = ["diamdiamaja", "ghosted_aja", "maganggratis", "temenpalsu", "konserginjal"];
                    dummyUsers.forEach(user => {
                        if (user !== currentUser && !userReactions[reactionType].users.includes(user)) {
                            userReactions[reactionType].users.push(user);
                        }
                    });
                }
                
                saveArtefakReactions(reactions);
                currentArtefakReactions = userReactions;
                
                // Update UI
                renderArtefakPreview();
                showToast(`Kamu bereaksi dengan ${reactionType}!`);
            } else {
                showToast(`Kamu sudah bereaksi dengan ${reactionType}`);
            }
        }
        
        function renderArtefakGrid() {
            const c = document.getElementById('artefaksGrid');
            c.innerHTML = '';
            
            dummyArtefakPhotos.forEach(photo => {
                const div = document.createElement('div');
                div.className = 'artefak-grid-item';
                div.onclick = () => showToast(`"${photo.title}" - ${photo.date}`);
                div.innerHTML = `
                    <img src="${photo.url}" alt="${photo.title}" class="artefak-grid-image" loading="lazy">
                    <div class="artefak-grid-overlay">
                        <div class="artefak-grid-title">${photo.title}</div>
                        <div class="artefak-grid-date">${photo.date}</div>
                    </div>
                `;
                c.appendChild(div);
            });
        }
        
        function renderRecentRants() {
            const c = document.getElementById('recentRantsList');
            const d = getUserData(currentUser);
            if (!d.rants || d.rants.length === 0) {
                // Tampilkan 3 dummy rant jika belum ada postingan
                const dummyRants = [
                    { content: "Gue juga ngerasain... capek banget. Kadang pengen nangis aja.", date: Date.now() - 3600000, hashtag: "#CapekPuraPura" },
                    { content: "Gue ngerasain kayak dijebak sama hidup. Kerjaan banyak, gaji kecil, bos galak, pacar ngilang. Kayaknya gue harus istirahat dulu.", date: Date.now() - 7200000, hashtag: "#SayNOPE" },
                    { content: "Hari ini gue ngerasain semua emosi sekaligus. Senang karena dapet kerjaan baru, sedih karena harus tinggalin rumah, takut karena belum siap, dan marah karena gak ada yang ngerti. Mungkin ini namanya dewasa? Atau cuma kelelahan?", date: Date.now() - 10800000, hashtag: "#DiamDiamNangis" }
                ];
                c.innerHTML = '';
                dummyRants.forEach(r => {
                    const date = new Date(r.date).toLocaleDateString('id-ID', { day: 'numeric', month: 'short', hour: '2-digit', minute: '2-digit' });
                    const content = r.content.length > 100 ? r.content.substring(0, 100) + '...' : r.content;
                    const div = document.createElement('div');
                    div.className = 'recent-rant-item';
                    div.onclick = () => viewRantDetails(r);
                    div.innerHTML = `<div class="recent-rant-date">${date} ‚Ä¢ ${r.hashtag || ''}</div><div class="recent-rant-content">${content}</div>`;
                    c.appendChild(div);
                });
                return;
            }
            const rants = d.rants.slice(-3).reverse();
            c.innerHTML = '';
            rants.forEach(r => {
                const date = new Date(r.date).toLocaleDateString('id-ID', { day: 'numeric', month: 'short', hour: '2-digit', minute: '2-digit' });
                const content = r.content.length > 100 ? r.content.substring(0, 100) + '...' : r.content;
                const div = document.createElement('div');
                div.className = 'recent-rant-item';
                div.onclick = () => viewRantDetails(r);
                div.innerHTML = `<div class="recent-rant-date">${date} ‚Ä¢ ${r.hashtag || ''}</div><div class="recent-rant-content">${content}</div>`;
                c.appendChild(div);
            });
        }
        
        function postRantFromBox() {
            const content = document.getElementById('rantBox').value.trim();
            if (!content) { alert('Tulis rant terlebih dahulu!'); return; }
            if (!currentUser) return;
            const d = getUserData(currentUser);
            if (!d.rants) d.rants = [];
            d.rants.push({ content, date: Date.now() });
            d.lastLogin = Date.now();
            saveUserData(currentUser, d);
            document.getElementById('rantBox').value = '';
            renderRecentRants();
            showToast('Rant berhasil diposting!');
        }
        
        // ===== JALAN =====
        function initJalanPage() {
            if (!currentUser) return showPage('login');
            const d = getUserData(currentUser);
            renderSelectedHashtags();
            renderFrekuensiFeed();
            renderGelombangFeed();
            renderMovementFeed();
            showJalanTab('frekuensi');
        }
        
        function renderSelectedHashtags() {
            const c = document.getElementById('selectedHashtagsList');
            const d = getUserData(currentUser);
            if (!d.selectedHashtags) {
                c.innerHTML = '<div class="hint">Belum memilih hashtag</div>';
                return;
            }
            c.innerHTML = '';
            Object.entries(d.selectedHashtags).forEach(([z, h]) => {
                if (h) {
                    const span = document.createElement('span');
                    span.style.padding = '4px 8px';
                    span.style.background = 'rgba(73, 3, 252, 0.1)';
                    span.style.borderRadius = '6px';
                    span.style.fontSize = '12px';
                    span.style.color = '#4903fc';
                    span.textContent = h;
                    c.appendChild(span);
                }
            });
        }
        
        function showJalanTab(tab) {
            ['frekuensi','gelombang','movement'].forEach(t => {
                document.getElementById(`jalan-${t}`).style.display = t === tab ? 'block' : 'none';
            });
            document.querySelectorAll('.jalan-tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
        }
        
        // ===== UTILITIES =====
        function showToast(message) {
            const t = document.createElement('div');
            t.style.cssText = `position:fixed;top:20px;left:50%;transform:translateX(-50%);background:rgba(73, 3, 252, 0.9);color:white;padding:12px 20px;border-radius:8px;font-size:14px;font-weight:500;z-index:10000;animation:fadeIn 0.3s ease;`;
            t.textContent = message;
            document.body.appendChild(t);
            setTimeout(() => {
                t.style.opacity = '0';
                t.style.transition = 'opacity 0.3s ease';
                setTimeout(() => document.body.removeChild(t), 300);
            }, 3000);
        }
        
        function exportData() {
            if (!currentUser) return;
            const d = getUserData(currentUser);
            const blob = new Blob([JSON.stringify({ username: currentUser, exportedAt: new Date().toISOString(), userData: d }, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `nope-${currentUser}-${Date.now()}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        
        function logout() {
            if (confirm('Yakin ingin keluar?')) {
                localStorage.removeItem('nope_current_user');
                currentUser = null;
                showPage('login');
            }
        }
        
        // ===== INITIALIZE =====
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('modalOverlay').addEventListener('click', e => {
                if (e.target === e.currentTarget) hideModal();
            });
            initializeApp();
        });
    </script>
</body>
</html>
