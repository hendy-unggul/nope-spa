<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
  <link rel="manifest" href="/manifest.json">
  <link rel="icon" href="/icon-192.png">
  <meta name="theme-color" content="#569CD6">
  <title>NOPE</title>
  <style>
    :root {
      --safe-top: env(safe-area-inset-top, 0px);
      --safe-bottom: env(safe-area-inset-bottom, 0px);
    }
    * {
      -webkit-tap-highlight-color: transparent;
      box-sizing: border-box;
    }
    body {
      margin: 0;
      background: #000;
      color: #fff;
      font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', 'Segoe UI', Helvetica, Arial, sans-serif;
      font-size: 14px;
      line-height: 1.45;
      -webkit-font-smoothing: antialiased;
    }
    .container {
      max-width: 390px;
      margin: 0 auto;
      padding: 16px 12px;
      padding-bottom: calc(68px + var(--safe-bottom));
    }
    .screen {
      display: none;
    }
    .screen.active {
      display: block;
    }
    /* Landing */
    .landing {
      text-align: center;
      padding: 40px 20px;
    }
    .landing input {
      width: 100%;
      padding: 14px;
      background: #111;
      border: 1px solid #222;
      border-radius: 12px;
      color: #fff;
      font-size: 16px;
      margin: 12px 0 20px;
      text-align: center;
    }
    .landing input::placeholder {
      color: #555;
    }
    .cta {
      width: 100%;
      padding: 14px;
      background: #569CD6;
      color: #000;
      border: none;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
    }
    /* Onboarding */
    .onboarding-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
      margin: 20px 0;
    }
    .zone {
      background: #0a0a0a;
      border-radius: 12px;
      padding: 12px;
    }
    .zone-title {
      font-size: 12px;
      color: #569CD6;
      margin-bottom: 8px;
      font-weight: 600;
    }
    .hashtag-item {
      display: block;
      padding: 6px 0;
      font-size: 13px;
      color: #aaa;
      cursor: pointer;
    }
    .hashtag-item.selected {
      color: #569CD6;
      font-weight: 600;
    }
    .zone-instruction {
      text-align: center;
      font-size: 12px;
      color: #666;
      margin: 10px 0 20px;
    }
    /* Jejak UI */
    .artefact-header {
      width: 100%;
      aspect-ratio: 1 / 0.8;
      background: #111;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      overflow: hidden;
      margin-bottom: 6px;
      border-radius: 12px;
    }
    .artefact-image {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .artefact-stamp {
      position: absolute;
      top: 10px;
      left: 10px;
      background: rgba(0, 0, 0, 0.45);
      padding: 3px 7px;
      border-radius: 5px;
      font-size: 8px;
      color: rgba(255, 255, 255, 0.85);
      z-index: 10;
      max-width: 90%;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      backdrop-filter: blur(1px);
    }
    .artefact-notasi {
      font-size: 16px;
      font-weight: 600;
      color: #fff;
      margin-right: 3px;
    }
    .artefact-date {
      font-size: 8px;
      color: rgba(255, 255, 255, 0.5);
    }
    .emoji-bar {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      padding: 2px 12px 4px;
      margin-bottom: 10px;
    }
    .emoji-btn {
      background: none;
      border: none;
      color: #aaa;
      font-size: 14px;
      cursor: pointer;
      opacity: 0.8;
    }
    .rantbox {
      background: #0a0a0a;
      border-radius: 12px;
      padding: 12px;
      margin-bottom: 12px;
      overflow: hidden;
    }
    textarea {
      width: 100%;
      height: 88px;
      background: #111;
      border: 1px solid #222;
      border-radius: 10px;
      color: #fff;
      font-size: 14px;
      padding: 10px;
      resize: none;
      outline: none;
      display: block;
    }
    .inline-save {
      background: none;
      border: none;
      color: #569CD6;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      padding: 4px 0;
      margin-top: 6px;
      float: right;
      opacity: 0.9;
    }
    .jejakmu-title {
      font-size: 14px;
      color: #569CD6;
      margin: 2px 0 10px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .jejakmu-title::before {
      content: "ðŸ”’";
      font-size: 12px;
    }
    .rant-item {
      background: #0a0a0a;
      border-radius: 10px;
      padding: 12px;
      margin-bottom: 8px;
    }
    .rant-text {
      white-space: pre-line;
      font-size: 14px;
      line-height: 1.4;
    }
    .artefact-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 6px;
    }
    .grid-item {
      aspect-ratio: 1;
      border-radius: 8px;
      overflow: hidden;
      position: relative;
      background: #111;
    }
    .grid-item img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .grid-item .stamp {
      position: absolute;
      bottom: 2px;
      left: 0;
      right: 0;
      background: rgba(0,0,0,0.5);
      padding: 1px 3px;
      font-size: 7px;
      color: rgba(255,255,255,0.5);
      text-align: center;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    /* Micromovement */
    .rantbox, .artefact-header, .grid-item {
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    .rantbox:active, .artefact-header:active, .grid-item:active {
      transform: scale(1.01);
      box-shadow: 0 0 8px rgba(86, 156, 214, 0.3);
    }
    /* Bottom nav */
    .bottom-nav-wrapper {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      display: flex;
      justify-content: center;
      background: #000;
      border-top: 1px solid #1a1a1a;
      padding-bottom: var(--safe-bottom);
      z-index: 50;
    }
    .bottom-nav {
      display: flex;
      width: 100%;
      max-width: 390px;
    }
    .nav-item {
      flex: 1;
      text-align: center;
      padding: 10px 0;
      font-size: 12px;
      color: #666;
      text-decoration: none;
    }
    .nav-item.active {
      color: #569CD6;
      font-weight: 600;
    }
    /* Modal */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.85);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 300;
    }
    .modal-content {
      background: #0a0a0a;
      padding: 20px;
      border-radius: 14px;
      width: 90%;
      max-width: 340px;
      font-size: 13px;
      color: #aaa;
    }
    .modal-btns {
      display: flex;
      gap: 10px;
      margin-top: 16px;
    }
    .modal-btn {
      flex: 1;
      padding: 8px 16px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      border: none;
    }
    .modal-btn.save {
      background: #569CD6;
      color: #000;
    }
    .modal-btn.cancel, .modal-btn.close {
      background: #222;
      color: #aaa;
    }
    #artefactInput {
      display: none;
    }
  </style>
</head>
<body>
  <div id="app">
    <!-- Landing -->
    <div id="landingScreen" class="screen active">
      <div class="container">
        <div class="landing">
          <div style="font-size:24px;opacity:0.9;">NOPE</div>
          <input type="text" id="loginInput" placeholder="emailmu" autocomplete="off"/>
          <button class="cta" onclick="handleLogin()">lanjut</button>
        </div>
      </div>
    </div>

    <!-- Onboarding -->
    <div id="onboardingScreen" class="screen">
      <div class="container">
        <div class="zone-instruction">Pilih 1 hashtag dari 3 zona berbeda</div>
        <div class="onboarding-grid" id="onboardingGrid"></div>
        <button class="cta" onclick="finishOnboarding()" id="finishBtn" disabled>selesai</button>
      </div>
    </div>

    <!-- Jejak -->
    <div id="jejakScreen" class="screen">
      <!-- Isi Jejak di-generate oleh JS -->
    </div>
  </div>

  <div id="artefactInputContainer" style="display: none;">
    <input type="file" id="artefactInput" accept="image/*" onchange="handleArtefactUpload(event)">
  </div>

  <script>
    // ==== DATA ====
    const ZONES = {
      PopCulture: ["#bucin_toxic", "#fyp_addict", "#celeb_gosip", "#reels_overload", "#viral_hampa"],
      PersonalPain: ["#harga_diri", "#sendiri_tapi_nggak", "#cape_jadi_baik", "#galau_nyata", "#harapan_menipis"],
      SocialSickness: ["#toxic_wa_group", "#ghosting_budaya", "#pura_pura_sibuk", "#fomo_palsu", "#dm_tak_terjawab"],
      Movement: ["#diam_tapi_ngerasa", "#protes_diam", "#resistensi_soft", "#keberanian_kalem", "#berubah_dari_dalam"]
    };

    let currentUser = null;
    let selectedHashtags = new Map();

    // ==== Jurnal 3 Rant (FULL, tidak disingkat) ====
    const JOURNAL_FULL = [
      "gue udah bantuin dia tiap malem pas dia galau, sampe gue lupa ngerjain tugas sendiri. pas gue butuh temen buat ngobrol, dia malah offline terus. gak minta balasan sih, tapi rasanya kayak jadi tempat sampah emosi doang. capek jadi â€˜temen baikâ€™ yang cuma dipake pas dia perlu aja.",
      "deadline mepet, dosen gak jelas, dompet kering. rasanya pengen ijin cuti sehari buat jadi batu aja. gak perlu mikir, gak perlu ngomong, gak perlu diharapkan apa-apa.",
      "dia bilang â€˜kita temenan ajaâ€™ â€” iya, temen yang kau ghosting 3 minggu."
    ];

    // ==== INIT ====
    function init() {
      const email = localStorage.getItem('nopeEmail');
      const username = localStorage.getItem('nopeUsername');
      const onboarded = localStorage.getItem('nopeOnboarded') === 'true';
      if (email && username && onboarded) {
        currentUser = { email, username };
        showJejak();
      } else {
        showLanding();
      }
    }

    // ==== SCREENS ====
    function showLanding() {
      document.querySelectorAll('.screen').forEach(el => el.classList.remove('active'));
      document.getElementById('landingScreen').classList.add('active');
    }

    function showOnboarding() {
      document.querySelectorAll('.screen').forEach(el => el.classList.remove('active'));
      document.getElementById('onboardingScreen').classList.add('active');
      document.getElementById('finishBtn').disabled = true;
      selectedHashtags = new Map();
      const grid = document.getElementById('onboardingGrid');
      grid.innerHTML = '';
      Object.entries(ZONES).forEach(([zoneName, tags]) => {
        const zoneEl = document.createElement('div');
        zoneEl.className = 'zone';
        zoneEl.innerHTML = `<div class="zone-title">${zoneName}</div><div class="hashtag-list" id="zone-${zoneName}"></div>`;
        grid.appendChild(zoneEl);
        const list = zoneEl.querySelector('.hashtag-list');
        tags.forEach(tag => {
          const item = document.createElement('div');
          item.className = 'hashtag-item';
          item.textContent = tag;
          item.onclick = () => toggleHashtag(zoneName, tag);
          list.appendChild(item);
        });
      });
    }

    function showJejak() {
      document.querySelectorAll('.screen').forEach(el => el.classList.remove('active'));
      document.getElementById('jejakScreen').classList.add('active');
      renderJejak();
    }

    // ==== LOGIN ====
    function handleLogin() {
      const input = document.getElementById('loginInput').value.trim();
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!emailRegex.test(input)) {
        alert("Masukkan email yang valid.");
        return;
      }
      const savedEmail = localStorage.getItem('nopeEmail');
      if (savedEmail === input) {
        // existing user
        const username = localStorage.getItem('nopeUsername');
        currentUser = { email: input, username };
        showJejak();
      } else {
        // new user
        const adjectives = ['diam', 'sunyi', 'retak', 'senja', 'pulih', 'rahasia'];
        const adj = adjectives[Math.floor(Math.random() * adjectives.length)];
        const num = Math.floor(1000 + Math.random() * 9000);
        const username = `@nope.${adj}.${num}`;
        localStorage.setItem('nopeEmail', input);
        localStorage.setItem('nopeUsername', username);
        currentUser = { email: input, username };
        showOnboarding();
      }
    }

    // ==== ONBOARDING ====
    function toggleHashtag(zone, hashtag) {
      if (selectedHashtags.has(zone)) {
        selectedHashtags.delete(zone);
      } else {
        if (selectedHashtags.size >= 3) {
          alert("Pilih hanya dari 3 zona.");
          return;
        }
        selectedHashtags.set(zone, hashtag);
      }
      updateOnboardingUI();
    }

    function updateOnboardingUI() {
      document.querySelectorAll('.hashtag-item').forEach(el => el.classList.remove('selected'));
      selectedHashtags.forEach((hashtag, zone) => {
        const items = document.querySelectorAll(`.zone:nth-child(${Object.keys(ZONES).indexOf(zone)+1}+1) .hashtag-item`);
        items.forEach(item => {
          if (item.textContent === hashtag) item.classList.add('selected');
        });
      });
      document.getElementById('finishBtn').disabled = selectedHashtags.size !== 3;
    }

    function finishOnboarding() {
      const hashtags = Array.from(selectedHashtags.values());
      localStorage.setItem('nopeHashtags', JSON.stringify(hashtags));
      localStorage.setItem('nopeOnboarded', 'true');
      showJejak();
    }

    // ==== JEJAK ====
    function renderJejak() {
      const artefacts = JSON.parse(localStorage.getItem('nopeArtefacts') || '[]');
      const latest = artefacts.length > 0 ? artefacts[artefacts.length - 1] : null;
      const artefactImg = latest ? latest.url : "https://images.unsplash.com/photo-1600880292089-90a84e2c4a8f?w=800&h=640&fit=crop&auto=format";
      const artefactNotasi = latest ? latest.notasi : "â€”";
      const artefactDate = latest ? new Date(latest.date).toLocaleDateString('id-ID', { day: 'numeric', month: 'short', year: 'numeric' }) : "â€”";

      let rantsHtml = '';
      JOURNAL_FULL.forEach(text => {
        rantsHtml += `<div class="rant-item"><div class="rant-text">${text}</div></div>`;
      });

      document.getElementById('jejakScreen').innerHTML = `
        <div class="container">
          <div class="jejakmu-title">Jejakmu</div>
          <div class="artefact-header">
            <img class="artefact-image" src="${artefactImg}" alt="Artefak">
            <div class="artefact-stamp">
              <span class="artefact-notasi">${artefactNotasi}</span>
              <span class="artefact-date">${artefactDate}</span>
            </div>
          </div>
          <div class="emoji-bar">
            <button class="emoji-btn" onclick="uploadArtefact()">unggah artefak</button>
          </div>
          <div class="rantbox">
            <textarea id="rantInput" maxlength="300" placeholder="Curhat yang gak bisa dikirim ke DM..."></textarea>
            <button id="submitBtn" class="inline-save" onclick="submitRant()">simpan</button>
          </div>
          ${rantsHtml}
          <div class="artefact-grid">
            <div class="grid-item"><img src="https://images.unsplash.com/photo-1600880292089-90a84e2c4a8f?w=800&h=640&fit=crop" alt="Artefak"><span class="stamp">struk pertama â€¢ 5 Mar</span></div>
            <div class="grid-item"><img src="https://images.unsplash.com/photo-1575936123452-b67c3203c357?w=800&h=640&fit=crop" alt="Artefak"><span class="stamp">karcis terakhir â€¢ 15 Feb</span></div>
            <div class="grid-item"><img src="https://images.unsplash.com/photo-1517245386807-bb43f82c33c4?w=800&h=640&fit=crop" alt="Artefak"><span class="stamp">meja tempat aku menyerah â€¢ 20 Jan</span></div>
            <div class="grid-item"><img src="https://images.unsplash.com/photo-1506744038136-46273834b3fb?w=800&h=640&fit=crop" alt="Artefak"><span class="stamp">bayanganku yang setia â€¢ 5 Apr</span></div>
            <div class="grid-item"><img src="https://images.unsplash.com/photo-1511512578047-dfb367046420?w=800&h=640&fit=crop" alt="Artefak"><span class="stamp">chat yang diarsip â€¢ 10 May</span></div>
            <div class="grid-item"><img src="https://images.unsplash.com/photo-1517245386807-bb43f82c33c4?w=800&h=640&fit=crop" alt="Artefak"><span class="stamp">jepit yang tertinggal â€¢ 25 Jun</span></div>
          </div>
        </div>
        <div class="bottom-nav-wrapper">
          <nav class="bottom-nav">
            <a href="#" class="nav-item active" onclick="showJejak()">Jejak</a>
            <a href="#" class="nav-item" onclick="showJalan()">Jalan</a>
            <a href="#" class="nav-item" onclick="showDunia()">Dunia</a>
          </nav>
        </div>
      `;
    }

    // ==== JALAN (placeholder) ====
    function showJalan() {
      if (!localStorage.getItem('nopeOnboarded')) {
        alert("Selesaikan onboarding terlebih dahulu.");
        showOnboarding();
        return;
      }
      alert("Jalan akan hadir segera â€” tempat untuk sefrekuensi dan segelombang.");
      showJejak();
    }

    // ==== DUNIA (placeholder) ====
    function showDunia() {
      alert("Dunia akan hadir segera â€” tempat resensi buku, film, musik, dan tokoh.");
      showJejak();
    }

    // ==== UNGGAH ARTEFAK ====
    function uploadArtefact() {
      alert("Fitur unggah artefak akan hadir setelah onboarding selesai.");
    }

    function handleArtefactUpload(e) {
      // future logic
    }

    function submitRant() {
      const text = document.getElementById('rantInput').value.trim();
      if (!text) { alert("Tulis dulu."); return; }
      if (text.length > 300) { alert("Maksimal 300 karakter."); return; }
      alert("Disimpan. Tak seorang pun tahu.");
      document.getElementById('rantInput').value = '';
    }

    // ==== START ====
    init();
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js').catch(console.warn);
      });
    }
  </script>
</body>
</html>
