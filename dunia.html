<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dunia - NOPE</title>
    <style>
        :root {
            --nope-bg: #000;
            --nope-accent: #FF6B8B;
            --nope-secondary: #4ECDC4;
            --nope-text: #fff;
        }
        
        body {
            background: var(--nope-bg);
            color: var(--nope-text);
            font-family: -apple-system, sans-serif;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        
        .nope-header {
            text-align: center;
            padding: 30px 0;
            border-bottom: 1px solid rgba(255, 107, 139, 0.2);
            margin-bottom: 30px;
        }
        
        .nope-username {
            font-size: 2rem;
            color: var(--nope-accent);
            margin: 15px 0;
        }
        
        .nope-stats {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 20px 0;
            font-size: 0.9rem;
            opacity: 0.7;
        }
        
        .nope-content {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .nope-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            border: 1px solid rgba(255, 107, 139, 0.1);
        }
        
        .nope-section h3 {
            color: var(--nope-secondary);
            margin-top: 0;
        }
        
        .nope-interests {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 15px 0;
        }
        
        .nope-interest {
            background: rgba(255, 107, 139, 0.15);
            color: var(--nope-accent);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
        }
        
        .nope-journals {
            display: grid;
            gap: 15px;
        }
        
        .nope-journal {
            background: rgba(78, 205, 196, 0.1);
            border: 1px solid rgba(78, 205, 196, 0.2);
            border-radius: 10px;
            padding: 15px;
        }
        
        .nope-journal-date {
            font-size: 0.8rem;
            opacity: 0.7;
            margin-bottom: 10px;
        }
        
        .nope-actions {
            display: flex;
            gap: 10px;
            margin-top: 30px;
            justify-content: center;
        }
        
        .nope-btn {
            background: var(--nope-accent);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
        }
        
        .nope-btn-secondary {
            background: transparent;
            color: var(--nope-accent);
            border: 1px solid var(--nope-accent);
        }
        
        .nope-logout {
            position: fixed;
            bottom: 20px;
            right: 20px;
        }
        
        .nope-logout a {
            color: rgba(255, 255, 255, 0.5);
            font-size: 0.8rem;
            text-decoration: none;
        }
    </style>
</head>
<body>
    <div class="nope-header">
        <h1 style="margin:0;color:var(--nope-accent);font-size:2.5rem;">NOPE</h1>
        <div class="nope-username" id="usernameDisplay"></div>
        <div class="nope-stats">
            <span id="journalsCount">0 jurnal</span>
            <span id="artifactsCount">0 artefak</span>
            <span id="memberSince">hari ini</span>
        </div>
    </div>
    
    <div class="nope-content">
        <!-- 3# INTERESTS -->
        <div class="nope-section">
            <h3>âœ¨ 3# Kamu</h3>
            <div class="nope-interests" id="interestsContainer">
                <!-- Interests akan di-load dari localStorage -->
            </div>
            <small style="opacity:0.7;">Ini adalah vibe-mu di NOPE</small>
        </div>
        
        <!-- JOURNALS -->
        <div class="nope-section">
            <h3>ðŸ“– Jurnal Rant Terbaru</h3>
            <div class="nope-journals" id="journalsContainer">
                <!-- Journals akan di-load -->
            </div>
            <button class="nope-btn nope-btn-secondary" onclick="addJournal()" style="margin-top:15px;">
                + Tambah Jurnal
            </button>
        </div>
        
        <!-- ARTIFACTS -->
        <div class="nope-section">
            <h3>ðŸŽ¨ Artefak Terkini</h3>
            <div id="artifactsContainer">
                <!-- Artifacts akan di-load -->
            </div>
            <button class="nope-btn nope-btn-secondary" onclick="addArtifact()" style="margin-top:15px;">
                + Buat Artefak
            </button>
        </div>
        
        <div class="nope-actions">
            <button class="nope-btn" onclick="explore()">Jelajahi</button>
            <button class="nope-btn nope-btn-secondary" onclick="editProfile()">Edit 3#</button>
        </div>
    </div>
    
    <div class="nope-logout">
        <a href="#" onclick="logout()">â†ª logout</a>
    </div>

    <script>
        // ============================================
        // NOPE DUNIA - PERSISTENT DATA SYSTEM
        // ============================================
        
        let currentUser = null;
        let userData = null;
        
        document.addEventListener('DOMContentLoaded', function() {
            // Get username from session
            const username = sessionStorage.getItem('nope_username');
            
            if (!username) {
                // Not logged in
                window.location.href = '/';
                return;
            }
            
            currentUser = username;
            
            // Load user data from localStorage
            loadUserData();
            
            // Display user info
            displayUserInfo();
            
            // Load interests
            loadInterests();
            
            // Load journals
            loadJournals();
            
            // Load artifacts
            loadArtifacts();
        });
        
        // Load user data from persistent storage
        function loadUserData() {
            const allUsers = JSON.parse(localStorage.getItem('nope_users') || '{}');
            userData = allUsers[currentUser];
            
            if (!userData) {
                // User data not found (should not happen)
                alert('Data tidak ditemukan. Akan dibuat baru.');
                createUserData();
                loadUserData(); // Reload
            }
        }
        
        // Create user data if not exists
        function createUserData() {
            const allUsers = JSON.parse(localStorage.getItem('nope_users') || '{}');
            
            allUsers[currentUser] = {
                username: currentUser,
                created: Date.now(),
                lastLogin: Date.now(),
                interests: [],
                journals: [],
                artifacts: [],
                settings: {}
            };
            
            localStorage.setItem('nope_users', JSON.stringify(allUsers));
        }
        
        // Display user information
        function displayUserInfo() {
            // Username
            document.getElementById('usernameDisplay').textContent = `@${currentUser}`;
            
            // Member since
            if (userData.created) {
                const joinDate = new Date(userData.created);
                const options = { day: 'numeric', month: 'long', year: 'numeric' };
                document.getElementById('memberSince').textContent = 
                    `bergabung ${joinDate.toLocaleDateString('id-ID', options)}`;
            }
            
            // Stats
            document.getElementById('journalsCount').textContent = 
                `${userData.journals?.length || 0} jurnal`;
                
            document.getElementById('artifactsCount').textContent = 
                `${userData.artifacts?.length || 0} artefak`;
        }
        
        // Load and display interests
        function loadInterests() {
            const container = document.getElementById('interestsContainer');
            const interests = userData.interests || [];
            
            if (interests.length === 0) {
                container.innerHTML = '<p style="opacity:0.7;">Belum memilih 3#. <a href="#" onclick="editProfile()" style="color:var(--nope-accent);">Pilih sekarang?</a></p>';
                return;
            }
            
            container.innerHTML = interests.map(interest => 
                `<div class="nope-interest">${interest}</div>`
            ).join('');
        }
        
        // Load and display journals
        function loadJournals() {
            const container = document.getElementById('journalsContainer');
            const journals = userData.journals || [];
            
            if (journals.length === 0) {
                container.innerHTML = '<p style="opacity:0.7;text-align:center;">Belum ada jurnal rant. Mulai menulis?</p>';
                return;
            }
            
            // Show latest 3 journals
            const recentJournals = journals.slice(-3).reverse();
            
            container.innerHTML = recentJournals.map(journal => `
                <div class="nope-journal">
                    <div class="nope-journal-date">
                        ${new Date(journal.date).toLocaleDateString('id-ID', { 
                            weekday: 'long', 
                            year: 'numeric', 
                            month: 'long', 
                            day: 'numeric' 
                        })}
                    </div>
                    <div>${journal.content}</div>
                </div>
            `).join('');
        }
        
        // Load and display artifacts
        function loadArtifacts() {
            const container = document.getElementById('artifactsContainer');
            const artifacts = userData.artifacts || [];
            
            if (artifacts.length === 0) {
                container.innerHTML = '<p style="opacity:0.7;text-align:center;">Belum ada artefak. Buat sesuatu?</p>';
                return;
            }
            
            // Show latest artifacts
            const recentArtifacts = artifacts.slice(-5).reverse();
            
            container.innerHTML = recentArtifacts.map(artifact => `
                <div style="
                    background: rgba(255,255,255,0.05);
                    border-radius: 10px;
                    padding: 15px;
                    margin: 10px 0;
                    border-left: 3px solid var(--nope-secondary);
                ">
                    <div style="font-size:0.9rem;opacity:0.7;margin-bottom:5px;">
                        ${artifact.type} â€¢ ${new Date(artifact.created).toLocaleDateString('id-ID')}
                    </div>
                    <div>${artifact.content}</div>
                </div>
            `).join('');
        }
        
        // Add new journal
        function addJournal() {
            const content = prompt('Tulis jurnal rant-mu hari ini:');
            if (!content || content.trim() === '') return;
            
            const newJournal = {
                id: 'j_' + Date.now(),
                date: Date.now(),
                content: content.trim()
            };
            
            // Add to user data
            userData.journals = userData.journals || [];
            userData.journals.push(newJournal);
            
            // Save to localStorage
            saveUserData();
            
            // Reload display
            loadJournals();
            
            // Update stats
            document.getElementById('journalsCount').textContent = 
                `${userData.journals.length} jurnal`;
        }
        
        // Add new artifact
        function addArtifact() {
            const type = prompt('Jenis artefak (gambar, tulisan, puisi, link, dll):');
            if (!type) return;
            
            const content = prompt('Konten artefak:');
            if (!content) return;
            
            const newArtifact = {
                id: 'a_' + Date.now(),
                type: type.trim(),
                content: content.trim(),
                created: Date.now()
            };
            
            // Add to user data
            userData.artifacts = userData.artifacts || [];
            userData.artifacts.push(newArtifact);
            
            // Save to localStorage
            saveUserData();
            
            // Reload display
            loadArtifacts();
            
            // Update stats
            document.getElementById('artifactsCount').textContent = 
                `${userData.artifacts.length} artefak`;
        }
        
        // Save user data to persistent storage
        function saveUserData() {
            const allUsers = JSON.parse(localStorage.getItem('nope_users') || '{}');
            allUsers[currentUser] = userData;
            localStorage.setItem('nope_users', JSON.stringify(allUsers));
        }
        
        // Explore function
        function explore() {
            window.location.href = `/jalan.html?user=${currentUser}&t=${Date.now()}`;
        }
        
        // Edit profile/3#
        function editProfile() {
            window.location.href = `/onboarding.html?edit=${currentUser}&t=${Date.now()}`;
        }
        
        // Logout (session only, data persists)
        function logout() {
            if (confirm('Logout? Data 3#, jurnal, dan artefak akan tetap tersimpan.')) {
                // Clear session only
                sessionStorage.clear();
                
                // Update last login time
                userData.lastLogin = Date.now();
                saveUserData();
                
                // Redirect to home
                window.location.href = '/?logout=' + Date.now();
            }
        }
        
        // Auto-save on page unload
        window.addEventListener('beforeunload', function() {
            if (currentUser && userData) {
                userData.lastLogin = Date.now();
                saveUserData();
            }
        });
    </script>
</body>
</html>
